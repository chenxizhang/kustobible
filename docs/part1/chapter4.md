# ç¬¬å››ç« ï¼šæ•°æ®å¯¼å…¥å’Œå¯¼å‡º

> ä½œè€…ï¼šé™ˆå¸Œç« ï¼Œ2023å¹´1æœˆ äºä¸Šæµ· 
> ä¸“æ ï¼š**å¤§æ•°æ®åˆ†ææ–°ç©æ³•ä¹‹Kustoå®å…¸** ç¬¬ä¸€å­£ï¼šä¸€å…ƒåˆå§‹
> åé¦ˆï¼š[ares@xizhang.com](mailto:ares@xizhang.com)


åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `https://help.kusto.windows.net` è¿™ä¸ªèŒƒä¾‹ç¾¤é›†ï¼Œä»¥åŠä¸»è¦ä½¿ç”¨äº†å®ƒå†…éƒ¨çš„ `Samples` è¿™ä¸ªæ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢å’Œåˆ†æã€‚

é‚£ä¹ˆï¼Œç°åœ¨æ˜¯æ—¶å€™æ¥åˆ›å»ºè‡ªå·±çš„ç¾¤é›†ï¼Œæ•°æ®åº“ï¼Œå¹¶ä¸”æŒ‰ç…§è‡ªå·±çš„éœ€è¦æ¥å¯¼å…¥å’Œå¯¼å‡ºæ•°æ®äº†ï¼Œåªæœ‰å®Œæˆäº†è¿™ä¸€æ­¥ï¼Œä½ æ‰èƒ½è¾ƒä¸ºå…¨é¢åœ°æŒæ¡Kustoï¼ˆæˆ–è€…å«Azure Data Explorerï¼‰çš„èƒ½åŠ›ã€‚

å¦‚æœä½ å¸Œæœ›åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ ADEï¼Œ ä½ éœ€è¦æœ‰Microsoft Azureçš„è®¢é˜…ï¼Œç„¶åé€šè¿‡ <https://portal.azure.com/#create/Microsoft.AzureKusto> æ¥åˆ›å»ºï¼Œå®ƒçš„æ”¶è´¹æ–¹å¼ï¼Œè¯·å‚è€ƒ https://azure.microsoft.com/en-us/pricing/details/data-explorer/ çš„è¯¦æƒ…ã€‚

ä½†æ˜¯ï¼Œå¦‚æœä½ åªæ˜¯ç”¨æ¥ç ”ç©¶å’Œå­¦ä¹ ï¼Œåˆ™å®Œå…¨å¯ä»¥ä»å…è´¹çš„ç¾¤é›†å¼€å§‹ã€‚

## åˆ›å»ºå…è´¹ç¾¤é›†

ä¸ºäº†åˆ›å»ºå…è´¹ç¾¤é›†ï¼Œä½ å¯ä»¥è®¿é—® <https://aka.ms/kustofree> æˆ–è€… <https://dataexplorer.azure.com/freecluster>ã€‚

![](../images/Pasted%20image%2020230102222124.png)

è¾“å…¥ä½ æƒ³è¦çš„ç¾¤é›†æ˜¾ç¤ºåç§°ï¼Œæ•°æ®åº“åç§°å’Œä½ç½®ï¼Œç„¶åå®Œæˆç™»å½•æ“ä½œåï¼Œä½ å°±å¯ä»¥æ‹¥æœ‰è‡ªå·±ä¸“å±çš„ç¾¤é›†äº†ã€‚ä½ å¯ä»¥ç”¨ Microsoft ä¸ªäººè´¦å·ï¼Œæˆ–è€…å·¥ä½œè´¦å·ç™»å½•ã€‚

![](../images/Pasted%20image%2020230102221955.png)

æ¯ä¸ªç¾¤é›†éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ï¼Œä½œä¸ºå…è´¹ç¾¤é›†ï¼Œä½ ä¸å¯ä»¥ä¿®æ”¹è¿™ä¸ªåœ°å€ã€‚è€Œå³ä¾¿æ˜¯å…è´¹ç‰ˆæœ¬ï¼Œä½ ä¹Ÿæ‹¥æœ‰äº†ç›¸å½“ä¸é”™çš„é…ç½®ã€‚

![](../images/Pasted%20image%2020230102221540.png)

å½“ç„¶ï¼Œå®ƒè·Ÿæ­£å¼ç‰ˆè‚¯å®šä¼šæœ‰æ‰€å·®å¼‚ï¼Œè¯·é€šè¿‡ä¸‹è¡¨äº†è§£ã€‚

![](../images/Pasted%20image%2020230102221421.png)


## åˆ›å»ºæ•°æ®åº“

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå…è´¹ç¾¤é›†ä¸­å…è®¸æœ€å¤š10ä¸ªæ•°æ®åº“ã€‚åˆ›å»ºæ•°æ®åº“æ˜¯å¾ˆç®€å•çš„ï¼Œä½ è¿˜æ˜¯å¯ä»¥é€šè¿‡ <https://aka.ms/kustofree> è¿›å…¥æ§åˆ¶é¢æ¿ï¼Œç„¶åç‚¹å‡» â€Create database â€œ å³å¯ã€‚

![](../images/Pasted%20image%2020230102222815.png)

ä¸ºäº†ä¾¿äºä¸€èµ·åšç»ƒä¹ ï¼Œè¯·ç¡®ä¿ä½ åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®åº“å« â€Kusto2023â€œã€‚

## å¯¼å…¥æ•°æ®

æœ‰äº†ç¾¤é›†å’Œæ•°æ®åº“ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯¼å…¥ä½ è‡ªå·±éœ€è¦çš„æ•°æ®äº†ã€‚ä½ å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œå¯¼å…¥ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€ä¸€ä»‹ç»ã€‚

### ä»æœ¬åœ°æ•°æ®ä¸­å¯¼å…¥

è¿™æ˜¯åˆå­¦è€…æœ€å¸¸è§çš„ä¸€ç§æ–¹å¼ï¼Œè°è¿˜æ²¡æœ‰ä¸€ç‚¹æ•°æ®åœ¨æœ¬åœ°è®¡ç®—æœºå‘¢ï¼Ÿè™½ç„¶Kustoæ”¯æŒå¾ˆå¤šä¸åŒçš„æ ¼å¼ï¼Œä½†ç”¨çš„æœ€å¤šçš„è¿˜æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œè€Œä¸”å…·ä½“æ¥è¯´å°±æ˜¯ `csv` æ–‡ä»¶å’Œ `tsv` æ–‡ä»¶ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ `json` æ–‡ä»¶ã€‚

1. `csv` å’Œ `tsv` éƒ½æ˜¯ç”¨åˆ†éš”ç¬¦éš”æ–­çš„æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒºåˆ«åœ¨äº `csv` ç”¨çš„æ˜¯é€—å·ï¼ˆï¼Œï¼‰ï¼Œè€Œ `tsv` ç”¨çš„æ˜¯Tabé”®ã€‚ 
2. æˆ‘ä¸ªäººæ›´å–œæ¬¢ç”¨ `csv` ï¼Œä½†æ˜¯ `tsv` åœ¨æŸäº›æ—¶å€™ä¹Ÿæœ‰å¥‡æ•ˆï¼Œå°¤å…¶æ˜¯ä½ çš„æ•°æ®å­—æ®µä¸­åŒ…å«å¼•å·ï¼Œé€—å·ï¼Œç©ºæ ¼ç­‰å­—ç¬¦æ—¶ã€‚
3. `json` æ ¼å¼ä¼šç»™å¯¼å…¥å¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ï¼Œé™¤éå¿…è¦ï¼Œå°½é‡å°‘ç”¨ã€‚

å‡è®¾ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª `csv` æ–‡ä»¶ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ç”¨å¦‚ä¸‹çš„ Powershell å‘½ä»¤ç”Ÿæˆäº†å½“å‰æˆ‘çš„ç”µè„‘è¿è¡Œçš„ç¨‹åºçš„æ¸…å•ã€‚

`gps | Export-Csv gps.csv`

> ä½ å¯èƒ½ä¼šç»å¸¸ç”¨åˆ° Export-Csv è¿™ä¸ªå‘½ä»¤ï¼Œè¯·å‚è€ƒå®ƒçš„è¯¦ç»†è¯´æ˜ <https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/export-csv> ,  å¦‚æœæ˜¯å¯¼å‡º `tsv`ï¼Œåˆ™è¿™ä¸ªå‘½ä»¤æ˜¯ `gps | Export-Csv gps.tsv -Delimiter `t`

è¿™ä¸ªæ–‡ä»¶çœ‹èµ·æ¥æ˜¯ä¸‹é¢è¿™æ ·çš„

![](../images/Pasted%20image%2020230103053109.png)

é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹å¦‚ä½•å°†è¿™ä¸ªæ–‡ä»¶å¯¼å…¥åˆ° Kusto2023 è¿™ä¸ªæ•°æ®åº“å§ã€‚ä½ å¯ä»¥é€šè¿‡è®¿é—® https://aka.ms/kustofree è¿›å…¥å…è´¹ç¾¤é›†çš„é¦–é¡µã€‚

![](../images/Pasted%20image%2020230103055505.png)

ç‚¹å‡» â€Ignestâ€œ è¿™ä¸ª æŒ‰é’®ï¼Œè¿›å…¥ä¸‹é¢çš„ç•Œé¢ã€‚

![](../images/Pasted%20image%2020230103055548.png)

è®¾ç½®å¥½Clusterï¼ŒDatabaseï¼Œå¹¶é€‰æ‹© New Tableé€‰é¡¹ï¼Œè¾“å…¥æ–°çš„è¡¨çš„åç§°åç‚¹å‡» â€Next: Sourceâ€œ æŒ‰é’®æ¥é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶ã€‚

![](../images/Pasted%20image%2020230103055722.png)

å°†æ–‡ä»¶æ‹–æ”¾åˆ°è¿™ä¸ªç•Œé¢ï¼Œä¹Ÿå¯ä»¥ç‚¹å‡» â€Upload filesâ€œæŒ‰é’®æ¥é€‰æ‹©æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©æœ€å¤š1000ä¸ªæ–‡ä»¶ã€‚å¦‚æœä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œåˆ™ç‚¹å‡» â€Nextï¼šSchemeâ€œæŒ‰é’®è¿›å…¥ä¸‹ä¸€æ­¥ã€‚

![](../images/Pasted%20image%2020230103055944.png)

å¯¹äºä¸€äº›ä¸ç”šå¤æ‚çš„æ–‡ä»¶ï¼Œè¿™ä¸ªå‘å¯¼è¶³å¤Ÿèªæ˜ï¼Œå®ƒä¼šè‡ªåŠ¨è¯†åˆ«å‡ºæ¥æ–‡ä»¶çš„æ ¼å¼ã€æ˜¯å¦å‹ç¼©ã€ä»¥åŠæ¯ä¸ªåˆ—çš„æ•°æ®ç±»å‹ç­‰ã€‚å½“ç„¶å¦‚æœä½ ä¸æ»¡æ„ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹æŸäº›åˆ—çš„ç±»å‹ï¼ˆä½†è¦æ³¨æ„ï¼Œä¸æ°å½“çš„æ•°æ®ç±»å‹ä¿®æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰ã€‚

![](../images/Pasted%20image%2020230103060128.png)

è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•å°† Handles è¿™ä¸ªå­—æ®µçš„ç±»å‹ä» long æ”¹ä¸º int ï¼ˆç‚¹å‡»å­—æ®µå³ä¾§çš„ä¸‹æ‹‰ç®­å¤´ï¼Œé€‰æ‹© `Change data type` ï¼Œ ç„¶åé€‰æ‹© `int` ï¼‰ï¼Œ è¿™æ ·ç†è®ºä¸Šå ç”¨çš„å­˜å‚¨ç©ºé—´ä¼šå°ä¸€äº›ã€‚

è¯·ç•™æ„ç•Œé¢çš„å³ä¾§ä½ç½®æœ‰ä¸€ä¸ªå¤åˆ¶æŒ‰é’®ï¼Œè¯·å…ˆç‚¹å‡»ä¸€ä¸‹ï¼Œå¹¶ä¸”å°†å¤åˆ¶å¾—åˆ°çš„å†…å®¹æ”¾åœ¨åˆé€‚ä½ç½®ï¼Œåç»­çš„ç»ƒä¹ ä¼šç”¨åˆ°ã€‚

![](../images/Pasted%20image%2020230103060524.png)

ä¸€åˆ‡å‡†å¤‡å°±ç»ªäº†ï¼Œè¯·ç‚¹å‡»ç•Œé¢ä¸Šçš„ â€Nextï¼šStart Ingestionâ€œ æŒ‰é’®å¼€å§‹å¯¼å…¥ã€‚

![](../images/Pasted%20image%2020230103060719.png)

è¯·ç­‰å¾…å¯¼å…¥å®Œæˆåï¼Œç‚¹å‡» â€Closeâ€œ æŒ‰é’®å…³é—­å½“å‰çª—å£ï¼Œè¿›å…¥æŸ¥è¯¢çª—å£ï¼Œæˆ‘ä»¬é€šè¿‡å¦‚ä¸‹çš„æŸ¥è¯¢æ¥éªŒè¯ä¸€ä¸‹æ•°æ®ã€‚

```kql
Processes
| summarize sum(VM) by Company
| render piechart
```

![](../images/Pasted%20image%2020230103060933.png)

è¿™ä¸ªæŸ¥è¯¢æŒ‰ç…§åº”ç”¨è½¯ä»¶çš„å‚å•†ç»Ÿè®¡ä»–ä»¬å ç”¨çš„å†…å­˜æ•°å’Œæ¯”ä¾‹ã€‚è¯·æ³¨æ„ï¼Œä½ é‚£è¾¹çš„æ•°æ®å¯èƒ½è·Ÿæˆ‘ä¸åŒï¼Œçœ‹åˆ°çš„ç»“æœä¹Ÿå¯èƒ½ä¸ä¸€æ ·ã€‚

è¯·æ³¨æ„ï¼Œä½ é€‰æ‹©çš„æ–‡ä»¶å…¶å®æ˜¯è¦å…ˆä¸Šä¼ åˆ°ä¸€ä¸ªä¸´æ—¶çš„Azure Storageä¸­å»ï¼Œä½¿ç”¨å®Œåä¼šè‡ªåŠ¨åˆ é™¤ã€‚æ‰€ä»¥å¦‚æœä½ çš„æ–‡ä»¶è¾ƒå¤šï¼Œè€Œä¸”ä½“ç§¯ä¹Ÿä¸å°ï¼Œå»ºè®®å…ˆåšå‹ç¼©ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„å‹ç¼©ä¸æ˜¯æŒ‡ä½ æŠŠå¤šä¸ªæ–‡ä»¶ç›´æ¥æ‰“åŒ…ä¸ºä¸€ä¸ªzipæ–‡ä»¶ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯æ— æ³•è¯†åˆ«çš„ï¼Œä½ éœ€è¦ç›´æ¥å¯¹å•ä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œè€Œä¸”éœ€è¦ç”¨ `gzip` è¿›è¡Œå‹ç¼©ã€‚

`gzip` ä¸æ˜¯ä¸€ä¸ªWindowsè‡ªå¸¦çš„å·¥å…·ï¼Œä½ å¯ä»¥é€šè¿‡<https://gnuwin32.sourceforge.net/packages/gzip.htm>  ä¸‹è½½å¾—åˆ°å®ƒã€‚å¦‚æœä½ çš„ç”µè„‘ä¸Šå®‰è£…äº† `git bash` è¿™ä¸ªå·¥å…·ï¼Œä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“è°ƒç”¨å®ƒã€‚è¯·å‚è€ƒä¸‹é¢çš„æ“ä½œã€‚

```
gzip gps.csv
```

![](../images/Pasted%20image%2020230103061913.png)

è¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ª `gps.csv.gz` çš„æ–‡ä»¶ï¼ŒåŸå§‹æ–‡ä»¶å°±æ²¡æœ‰äº†ï¼ˆä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯å°±åœ°å‹ç¼©ï¼‰ï¼Œè€Œå®ƒçš„ä½“ç§¯å¤§è‡´ä¸ºåŸæ–‡ä»¶çš„ 1/6 ï¼Œå¦‚æœä½ çš„ç½‘ç»œå¸¦å®½æœ‰é™ï¼Œä¸”åˆéœ€è¦ä¸Šä¼ å¤§é‡çš„æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥å¾ˆå¤§çš„æ•ˆç‡æå‡ã€‚

![](../images/Pasted%20image%2020230103062127.png)

è¿˜æœ‰ä¸€ä¸ªæŠ€å·§ï¼Œæ˜¯å¯ä»¥å°†è¿™ä¸ª gzip çš„å·¥å…·åœ¨ä½ å¸¸ç”¨çš„PowerShellä¸­å®šä¹‰ä¸€ä¸ªå¿«æ·æŒ‡ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤º

```powershell
'New-Alias gz "C:\Program Files\Git\usr\bin\gzip.exe"' | Out-File -Append $profile
. $profile
```

ä»¥åå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç›´æ¥è¿è¡Œ `gz` å‘½ä»¤äº†ã€‚


 
### ä»Azure Blobä¸­å¯¼å…¥

ä»æœ¬åœ°æ–‡ä»¶ä¸Šä¼ è™½ç„¶æ˜¯è¿‡ç˜¾çš„ï¼Œä½†å¤§éƒ¨åˆ†æ—¶å€™ï¼Œä½ çš„æ–‡ä»¶é€šå¸¸ä¸åœ¨æœ¬åœ°ï¼Œè¿™äº›æ–‡ä»¶å¯èƒ½æ¥è‡ªäºç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿—ï¼Œå¦‚æœè¦å®ç°ä»äº‘ç«¯å¯¼å…¥ï¼Œç›®å‰æ¥è¯´ï¼Œä½ éœ€è¦å°†ä»–ä»¬ä¸Šä¼ åˆ°ä¸€ä¸ªå…¬ç½‘å¯ä»¥è®¿é—®åˆ°çš„åœ°å€ï¼Œæœ€å¥½æ˜¯Azure Blob Storage ä¸­ã€‚

ä¸‹å›¾æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘æœ‰ä¸€ä¸ªåç§°å«  `chenxizhang` çš„å­˜å‚¨è´¦å·ï¼ˆStorage accountï¼‰ï¼Œç„¶ååœ¨é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ªå« `data` çš„å®¹å™¨ï¼ˆContainerï¼‰ï¼Œç„¶åæˆ‘æŠŠåˆšæ‰ç”¨åˆ°çš„ `gps.csv.gz` è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°äº†è¿™ä¸ªå®¹å™¨ã€‚

![](../images/Pasted%20image%2020230103063746.png)

ä¸ºäº†èƒ½ä»è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå¯¼å…¥ï¼Œä½ éœ€è¦å¾—åˆ°ä¸€ä¸ªå¯ä»¥ç›´æ¥è®¿é—®å®ƒçš„åœ°å€ï¼Œé€šå¸¸æˆ‘ä»¬çš„ Container å¯¹å¤–éƒ½æ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„ï¼Œä½†ä½ å¯ä»¥ä¸ºå•ç‹¬çš„æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªSAS ï¼ˆshared access signatureï¼‰ åœ°å€ã€‚

![](../images/Pasted%20image%2020230103064345.png)

ç‚¹å‡» â€Generate SAS token and URLâ€œ æŒ‰é’®åï¼Œå¤åˆ¶æœ€åº•éƒ¨çš„åœ°å€ã€‚

é‚£ä¹ˆæ¥ä¸‹æ¥å¦‚ä½•ä»è¿™ä¸ªæ–‡ä»¶å¯¼å…¥æ•°æ®å‘¢ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯å›åˆ° Azure Data Explorerçš„ Ingest data é¡µé¢ã€‚å› ä¸ºæ­¤å‰æˆ‘ä»¬ä»æœ¬åœ°å¯¼å…¥è¿‡ä¸€æ¬¡ï¼Œç›®æ ‡è¡¨å·²ç»åˆ›å»ºå‡ºæ¥äº†ï¼Œæ‰€ä»¥è¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥é€‰æ‹© â€Existing tableâ€œ è¿™ä¸ªé€‰é¡¹ã€‚

![](../images/Pasted%20image%2020230103064020.png)

ç‚¹å‡» â€Nextï¼šSourceâ€œ æŒ‰é’®ï¼Œ å’Œä¹‹å‰ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œé€‰æ‹©çš„ Source type æ˜¯ Blobï¼Œç„¶åå°†ä½ åˆšæ‰å¤åˆ¶çš„SAS åœ°å€ç²˜è´´åˆ° Link to source è¿™ä¸ªæ¡†é‡Œé¢ã€‚

![](../images/Pasted%20image%2020230103064606.png)

åŒæ ·çš„ï¼Œè¿™ä¸ªå‘å¯¼ä¹Ÿèƒ½è‡ªåŠ¨è¯†åˆ«å‡ºæ¥æ–‡ä»¶çš„æ ¼å¼ï¼Œæ˜¯å¦å‹ç¼©ï¼Œç„¶åæˆ‘ä»¬é€‰æ‹© â€Use existing mapping" è¿™ä¸ªé€‰é¡¹ã€‚

![](../images/Pasted%20image%2020230103064716.png)

> å¦‚æœä½ çš„Blobæ–‡ä»¶æœ¬èº«æ˜¯å¯ä»¥åŒ¿åè®¿é—®çš„ï¼Œåˆ™ä¸éœ€è¦ç”ŸæˆSAS åœ°å€ã€‚ä¾‹å¦‚èŒƒä¾‹æ•°æ®åº“ä¸­çš„StormEventsè¿™ä¸ªè¡¨ï¼Œå…¶å®å®ƒå°±æœ‰ä¸€ä¸ªåŒ¿åè®¿é—®çš„åœ°å€ï¼ˆ<https://kustosamples.blob.core.windows.net/samplefiles/StormEvents.csv>ï¼‰ï¼Œä½ å¯ä»¥è¯•ä¸€ä¸‹ã€‚ 


### ä¸€æ¬¡æ€§å¯¼å…¥å¤šä¸ªBlobæ–‡ä»¶

åˆšæ‰æˆ‘ä»¬å¯¼å…¥äº†ä¸€ä¸ªBlobæ–‡ä»¶ï¼Œä¸‹é¢çœ‹çœ‹å¦‚ä½•èƒ½å®ç°ä¸€æ¬¡æ€§å¯¼å…¥å¤šä¸ªBlobæ–‡ä»¶ã€‚å…¶å®å¾ˆç®€å•ï¼Œä½ åªéœ€è¦æŠŠæ‰€æœ‰çš„åŒç±»æ–‡ä»¶éƒ½æ”¾åœ¨ä¸€ä¸ªContainerä¸‹é¢å³å¯ã€‚

![](../images/Pasted%20image%2020230103073708.png)

åŒæ ·ï¼Œä¸ºäº†è®¿é—®è¿™ä¸ªContainerï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå®ƒç”ŸæˆSAS URLã€‚è¯·æ³¨æ„ï¼Œå› ä¸ºè¦åˆ—å‡ºæ‰€æœ‰çš„æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨æƒé™è¿™é‡Œéœ€è¦ç”³è¯· List çš„æƒé™ã€‚

![](../images/Pasted%20image%2020230103073802.png)

ç”Ÿæˆè¿™ä¸ªSASåœ°å€åï¼Œä½ å°±å¯ä»¥åœ¨å¯¼å…¥å‘å¯¼é¡µé¢ä¸­ï¼Œé€‰æ‹©Source type ä¸º Blob containerï¼Œç„¶åå°†å¤åˆ¶å¾—åˆ°çš„SAS åœ°å€ï¼Œå¡«å…¥åˆ° Link to source è¿™ä¸ªæ¡†é‡Œé¢ã€‚

![](../images/Pasted%20image%2020230103073908.png)

å¦‚æœä½ ç»†å¿ƒçš„è¯ï¼Œ åœ¨ Source type çš„ä¸‹æ‹‰åˆ—è¡¨ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ª ADLS Gen2 Containerï¼Œ å®ƒè·Ÿè¿™é‡Œä»‹ç»çš„Blob Containeræ²¡æœ‰æœ¬è´¨ä¸Šçš„ä¸åŒï¼Œåªæ˜¯å®ƒæ˜¯ä¸€ç§æ›´åŠ å…ˆè¿›çš„å­˜å‚¨è´¦å·ç±»å‹ï¼Œ ADLS çš„æ„æ€æ˜¯ Azure data lake storageï¼Œ Gen2æ˜¯æŒ‡ç¬¬äºŒä»£çš„æ„æ€ã€‚å…³äºå®ƒçš„ä»‹ç»ï¼Œå¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥å‚è€ƒ https://learn.microsoft.com/en-us/azure/storage/blobs/data-lake-storage-introduction ã€‚ 

### ç”¨æ§åˆ¶å‘½ä»¤å¯¼å…¥æ•°æ®

ä¸Šé¢æˆ‘ä»¬éƒ½æ˜¯ç”¨å›¾å½¢åŒ–ç•Œé¢æ¥å®ç°å¯¼å…¥ï¼Œè¿™æœ¬èº«å¾ˆå¥½ï¼Œä¹Ÿä¸ä¸¢äººã€‚ä½†å¦‚æœä½ éœ€è¦å¯¼å…¥å¤§é‡çš„æ–‡ä»¶ï¼Œæˆ–è€…éœ€è¦è‡ªåŠ¨åŒ–å¯¼å…¥çš„è¿‡ç¨‹ï¼Œæˆ–ä½ å°±æ˜¯ä¸€ä¸ªçº¯ç²¹åœ°å–œæ¬¢è‡ªå·±å†™ä»£ç çš„æå®¢ï¼Œä½ å¯èƒ½ä¼šæƒ³äº†è§£æ‰€è°“çš„æ§åˆ¶å‘½ä»¤å¯¼å…¥æ•°æ®çš„æ–¹å¼ã€‚

è¿˜è®°å¾—æˆ‘ä¹‹å‰æé†’å¤§å®¶åœ¨å¯¼å…¥çš„ç•Œé¢ä¸Šå¤åˆ¶æ“ä½œå‘½ä»¤å—ï¼Ÿ å¦‚æœä½ æ²¡æœ‰å¿˜è®°ä¿å­˜èµ·æ¥ï¼Œé‚£ä¹ˆå®ƒçœ‹èµ·æ¥æ˜¯åƒä¸‹é¢è¿™æ ·çš„ã€‚

```kql
// åˆ›å»ºè¡¨
////////////////////////////////////////////////////////////
.create table ['Processes']  (['Name']:string, ['SI']:long, ['Handles']:long, ['VM']:long, ['WS']:long, ['PM']:long, ['NPM']:long, ['Path']:string, ['CommandLine']:string, ['Parent']:string, ['Company']:string, ['CPU']:real, ['FileVersion']:string, ['ProductVersion']:string, ['Description']:string, ['Product']:string, ['__NounName']:string, ['SafeHandle']:string, ['Handle']:long, ['BasePriority']:long, ['ExitCode']:string, ['HasExited']:bool, ['StartTime']:datetime, ['ExitTime']:string, ['Id']:long, ['MachineName']:string, ['MaxWorkingSet']:long, ['MinWorkingSet']:long, ['Modules']:string, ['NonpagedSystemMemorySize64']:long, ['NonpagedSystemMemorySize']:long, ['PagedMemorySize64']:long, ['PagedMemorySize']:long, ['PagedSystemMemorySize64']:long, ['PagedSystemMemorySize']:long, ['PeakPagedMemorySize64']:long, ['PeakPagedMemorySize']:long, ['PeakWorkingSet64']:long, ['PeakWorkingSet']:long, ['PeakVirtualMemorySize64']:long, ['PeakVirtualMemorySize']:long, ['PriorityBoostEnabled']:bool, ['PriorityClass']:string, ['PrivateMemorySize64']:long, ['PrivateMemorySize']:long, ['ProcessorAffinity']:long, ['SessionId']:long, ['StartInfo']:string, ['Threads']:string, ['HandleCount']:long, ['VirtualMemorySize64']:long, ['VirtualMemorySize']:long, ['EnableRaisingEvents']:bool, ['StandardInput']:string, ['StandardOutput']:string, ['StandardError']:string, ['WorkingSet64']:long, ['WorkingSet']:long, ['SynchronizingObject']:string, ['MainModule']:string, ['PrivilegedProcessorTime']:timespan, ['TotalProcessorTime']:timespan, ['UserProcessorTime']:timespan, ['ProcessName']:string, ['MainWindowHandle']:long, ['MainWindowTitle']:string, ['Responding']:bool, ['Site']:string, ['Container']:string)

// åˆ›å»ºå­—æ®µæ˜ å°„
////////////////////////////////////////////////////////////
.create table ['Processes'] ingestion csv mapping 'Processes_mapping' '[{"column":"Name", "Properties":{"Ordinal":"0"}},{"column":"SI", "Properties":{"Ordinal":"1"}},{"column":"Handles", "Properties":{"Ordinal":"2"}},{"column":"VM", "Properties":{"Ordinal":"3"}},{"column":"WS", "Properties":{"Ordinal":"4"}},{"column":"PM", "Properties":{"Ordinal":"5"}},{"column":"NPM", "Properties":{"Ordinal":"6"}},{"column":"Path", "Properties":{"Ordinal":"7"}},{"column":"CommandLine", "Properties":{"Ordinal":"8"}},{"column":"Parent", "Properties":{"Ordinal":"9"}},{"column":"Company", "Properties":{"Ordinal":"10"}},{"column":"CPU", "Properties":{"Ordinal":"11"}},{"column":"FileVersion", "Properties":{"Ordinal":"12"}},{"column":"ProductVersion", "Properties":{"Ordinal":"13"}},{"column":"Description", "Properties":{"Ordinal":"14"}},{"column":"Product", "Properties":{"Ordinal":"15"}},{"column":"__NounName", "Properties":{"Ordinal":"16"}},{"column":"SafeHandle", "Properties":{"Ordinal":"17"}},{"column":"Handle", "Properties":{"Ordinal":"18"}},{"column":"BasePriority", "Properties":{"Ordinal":"19"}},{"column":"ExitCode", "Properties":{"Ordinal":"20"}},{"column":"HasExited", "Properties":{"Ordinal":"21"}},{"column":"StartTime", "Properties":{"Ordinal":"22"}},{"column":"ExitTime", "Properties":{"Ordinal":"23"}},{"column":"Id", "Properties":{"Ordinal":"24"}},{"column":"MachineName", "Properties":{"Ordinal":"25"}},{"column":"MaxWorkingSet", "Properties":{"Ordinal":"26"}},{"column":"MinWorkingSet", "Properties":{"Ordinal":"27"}},{"column":"Modules", "Properties":{"Ordinal":"28"}},{"column":"NonpagedSystemMemorySize64", "Properties":{"Ordinal":"29"}},{"column":"NonpagedSystemMemorySize", "Properties":{"Ordinal":"30"}},{"column":"PagedMemorySize64", "Properties":{"Ordinal":"31"}},{"column":"PagedMemorySize", "Properties":{"Ordinal":"32"}},{"column":"PagedSystemMemorySize64", "Properties":{"Ordinal":"33"}},{"column":"PagedSystemMemorySize", "Properties":{"Ordinal":"34"}},{"column":"PeakPagedMemorySize64", "Properties":{"Ordinal":"35"}},{"column":"PeakPagedMemorySize", "Properties":{"Ordinal":"36"}},{"column":"PeakWorkingSet64", "Properties":{"Ordinal":"37"}},{"column":"PeakWorkingSet", "Properties":{"Ordinal":"38"}},{"column":"PeakVirtualMemorySize64", "Properties":{"Ordinal":"39"}},{"column":"PeakVirtualMemorySize", "Properties":{"Ordinal":"40"}},{"column":"PriorityBoostEnabled", "Properties":{"Ordinal":"41"}},{"column":"PriorityClass", "Properties":{"Ordinal":"42"}},{"column":"PrivateMemorySize64", "Properties":{"Ordinal":"43"}},{"column":"PrivateMemorySize", "Properties":{"Ordinal":"44"}},{"column":"ProcessorAffinity", "Properties":{"Ordinal":"45"}},{"column":"SessionId", "Properties":{"Ordinal":"46"}},{"column":"StartInfo", "Properties":{"Ordinal":"47"}},{"column":"Threads", "Properties":{"Ordinal":"48"}},{"column":"HandleCount", "Properties":{"Ordinal":"49"}},{"column":"VirtualMemorySize64", "Properties":{"Ordinal":"50"}},{"column":"VirtualMemorySize", "Properties":{"Ordinal":"51"}},{"column":"EnableRaisingEvents", "Properties":{"Ordinal":"52"}},{"column":"StandardInput", "Properties":{"Ordinal":"53"}},{"column":"StandardOutput", "Properties":{"Ordinal":"54"}},{"column":"StandardError", "Properties":{"Ordinal":"55"}},{"column":"WorkingSet64", "Properties":{"Ordinal":"56"}},{"column":"WorkingSet", "Properties":{"Ordinal":"57"}},{"column":"SynchronizingObject", "Properties":{"Ordinal":"58"}},{"column":"MainModule", "Properties":{"Ordinal":"59"}},{"column":"PrivilegedProcessorTime", "Properties":{"Ordinal":"60"}},{"column":"TotalProcessorTime", "Properties":{"Ordinal":"61"}},{"column":"UserProcessorTime", "Properties":{"Ordinal":"62"}},{"column":"ProcessName", "Properties":{"Ordinal":"63"}},{"column":"MainWindowHandle", "Properties":{"Ordinal":"64"}},{"column":"MainWindowTitle", "Properties":{"Ordinal":"65"}},{"column":"Responding", "Properties":{"Ordinal":"66"}},{"column":"Site", "Properties":{"Ordinal":"67"}},{"column":"Container", "Properties":{"Ordinal":"68"}}]'

// å¯¼å…¥æ•°æ®
///////////////////////////////////////////////////////////
.ingest async into table ['Processes'] (h'<blob path to upload>') with (format='csv',ingestionMappingReference='Processes_mapping',ingestionMappingType='csv',tags="['fa331bbd-c940-4630-8c2e-d5b20ec304dc']",ignoreFirstRecord=true)
```

ç¬¬ä¸€æ­¥ï¼ˆåˆ›å»ºè¡¨ï¼‰å’Œç¬¬äºŒæ­¥ï¼ˆåˆ›å»ºæ˜ å°„ï¼‰å¹¶ä¸æ˜¯æ¯æ¬¡éƒ½éœ€è¦æ‰§è¡Œï¼Œè€Œç¬¬ä¸‰æ­¥ï¼ˆå¯¼å…¥æ•°æ®ï¼‰ï¼Œå…¶å®ä½ è¦æ›¿æ¢çš„å°±æ˜¯ `<blob path to upload>`  è¿™é‡Œçš„ä¿¡æ¯å°±å¯ä»¥äº†ã€‚

å½“ç„¶ï¼Œè¦ç”¨è¿™ä¸ªè„šæœ¬æ¥æ‰§è¡Œï¼Œä½ çš„æ–‡ä»¶å¿…é¡»å·²ç»æ”¾åˆ°äº†äº‘ç«¯ï¼Œå¹¶ä¸”ç”Ÿæˆäº†SAS åœ°å€ã€‚

è¿™é‡Œå…¶å®è¿˜æœ‰ä¸€ä¸ªå°æŠ€å·§ã€‚å¤§å®¶æœ‰æ²¡æœ‰å‘ç°ï¼Œä¸Šé¢è¿™ä¸€å¤§å †ä»£ç ä¸­ï¼Œå…¶å®å æ®ä¸»è¦éƒ¨åˆ†çš„æ˜¯åˆ›å»ºè¡¨ç»“æ„å’Œæ˜ å°„ï¼Œå½“è¡¨çš„å­—æ®µä¸æ˜¯å¾ˆå¤šæ—¶ï¼Œè¿™å¹¶ä¸éš¾ï¼Œä½†å¦‚æœå­—æ®µè¶…è¿‡åä¸ªï¼Œä½ å°±ä¼šè§‰å¾—æ‰‹å·¥å†™é‚£äº›å­—æ®µåå’Œä»–ä»¬çš„æ•°æ®ç±»å‹ï¼Œä¼šå¾ˆåƒåŠ›ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ä»ä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶è‡ªåŠ¨å¾—åˆ°è¡¨ç»“æ„ï¼Œå¹¶ä¸”ç”¨äºæ¥åˆ›å»ºè¡¨å‘¢ï¼Ÿ

ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ ¹æ®ä¸€ä¸ªå®¹å™¨ï¼Œè‡ªåŠ¨ç”Ÿæˆè¡¨ç»“æ„ï¼Œå¹¶ä¸”ç”¨å‡ è¡Œç®€å•çš„å‘½ä»¤æ¥å®ç°å¯¼å…¥å§ã€‚

```
let options = dynamic({
Â  'StorageContainers': [
Â  Â  h@'https://chenxizhang.blob.core.windows.net/data?sp=rl&st=2023-01-02T23:37:45Z&se=2023-01-03T07:37:45Z&spr=https&sv=2021-06-08&sr=c&sig=439I73xNeFPsAtrXKFVJlLC3cnFGqoZeCrkRi6eFy6w%3D'
Â  ],

Â  'FileExtension': '.csv.gz',
Â  'DataFormat': 'csv'

});

evaluate infer_storage_schema(options)
```

è¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨äº†ä¸€ä¸ªæ’ä»¶ï¼ˆ`infer_storage_schema`ï¼‰ï¼Œå®ƒè¿”å›çš„ç»“æœåªæœ‰ä¸€ä¸ªå­—æ®µï¼Œå®ƒåŒ…å«æ‰€æœ‰å­—æ®µçš„å®šä¹‰ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥å¿«é€Ÿåˆ›å»ºä½ çš„è¡¨äº†ã€‚

![](../images/Pasted%20image%2020230103080215.png)


### ä»å…¶ä»–æ•°æ®åº“ä¸­å¯¼å…¥

é™¤äº†ä»æ–‡ä»¶ä¸­å¯¼å…¥æ•°æ®ï¼Œå¦å¤–ä¸€ç§ç»å¸¸ç”¨çš„æ–¹å¼æ˜¯ä»åˆ«çš„æ•°æ®åº“ä¸­å¤åˆ¶æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥æ˜¯åŸå§‹æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯èšåˆè¿‡ä¹‹åçš„è®¡ç®—ç»“æœã€‚

å‡è®¾æˆ‘ä»¬ç°åœ¨æƒ³æŠŠèŒƒä¾‹æ•°æ®åº“ä¸­çš„ StormEvents è¡¨å®Œæ•´åœ°å¤åˆ¶åˆ°è‡ªå·±çš„æ•°æ®åº“ï¼Œä½ å¯ä»¥å°è¯•ä¸‹é¢çš„æŸ¥è¯¢ã€‚

```
.set-or-append StormEvents <|
Â  Â  cluster('help').database('Samples').StormEvents
```

`.set-or-append` æ˜¯ä¸€ä¸ªæ§åˆ¶å‘½ä»¤ï¼Œæˆ‘ä»¬ä¸åœ¨è¿™ä¸€å­£ä¸­è¿‡å¤šåœ°å±•å¼€ï¼Œåªæ˜¯åœ¨ç”¨åˆ°æ—¶å°±ç”¨ä¸€ä¸‹ã€‚è¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯åˆ›å»ºæ–°è¡¨æˆ–è€…å‘ç°æœ‰è¡¨è¿½åŠ æ•°æ®ã€‚è¿™ä¸ªå‘½ä»¤çš„å¥½å¤„æ˜¯è¿åˆ›å»ºè¡¨çš„è¯­æ³•éƒ½ä¸éœ€è¦äº†ã€‚

`<|` è¿™ä¸ªæŒ‡ä»¤æ˜¯æŒ‡æŠŠåé¢æŸ¥è¯¢çš„ç»“æœï¼Œè¾“å‡ºåˆ°å‰é¢çš„ç›®æ ‡è¡¨ã€‚ç›®æ ‡è¡¨å¯ä»¥æ˜¯åŒä¸€ä¸ªæ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–æ•°æ®åº“ï¼Œç”šè‡³å…¶ä»–ç¾¤é›†ã€‚

ä¸‹é¢å†æ¥çœ‹ä¸€ä¸ªæ›´åŠ å¤æ‚ä¸€ç‚¹çš„ï¼ŒæŠŠè®¡ç®—ç»“æœè¿½åŠ åˆ°ç›®æ ‡è¡¨ä¸­ã€‚

```kql
.set-or-append StateSummarization <|
Â  Â  cluster('help').database('Samples').StormEvents
Â  Â  | summarize
Â  Â  Â  Â  count = count(),
Â  Â  Â  Â  crops = sum(DamageCrops),
Â  Â  Â  Â  property= sum(DamageProperty)
Â  Â  Â  Â  by
Â  Â  Â  Â  State,
Â  Â  Â  Â  bin(StartTime, 1d)
```

å…¶å®è®¤çœŸè¯´èµ·æ¥ï¼Œé™¤äº†è¡Œæ•°å¤šä¸€ç‚¹ä¹‹å¤–ï¼Œè¿™ä¸ªæŸ¥è¯¢ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚

![](../images/Pasted%20image%2020230103081859.png)


## å¯¼å‡ºæ•°æ®

æœ¬ç« çš„æœ€åæˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹å¦‚ä½•åœ¨éœ€è¦æ—¶å°†æŸ¥è¯¢çš„æ•°æ®å¯¼å‡ºï¼ŒåŒ…æ‹¬å¯¼å‡ºåˆ°æœ¬åœ°csvæ–‡ä»¶ï¼Œä»¥åŠå¯¼å‡ºåˆ°äº‘ç«¯çš„Blobæ–‡ä»¶ã€‚

### å¯¼å‡ºæœ¬åœ°csvæ–‡ä»¶

è¦å¯¼å‡ºä½ çš„æ•°æ®ï¼Œä½ åªéœ€è¦ç¼–å†™å¥½æŸ¥è¯¢ï¼Œç„¶åç¡®å®šå¾—åˆ°äº†ä½ æƒ³è¦çš„æ•°æ®ï¼Œæœ€ååœ¨å·¥å…·æ ä¸­ç‚¹å‡» â€œFileâ€ä¸‹æ‹‰èœå•ä¸­çš„ â€œExport to CSVâ€ å³å¯ã€‚

![](../images/Pasted%20image%2020230103082347.png)

> ğŸ“£è¦æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œè¿˜æœ‰ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œå°±æ˜¯å…ˆæŒ‰ä¸‹ F1 é”®ï¼Œå‘¼å”¤å‡ºå‘½ä»¤çª—å£ï¼Œç„¶åè¾“å…¥ exportï¼Œå›è½¦å³å¯ã€‚


å¦‚æœä½ ä½¿ç”¨æœ¬åœ°çš„ Kusto.explorer è¿™ä¸ªå·¥å…·ï¼Œåˆ™å¯¼å‡ºçš„é€‰é¡¹ä¼šå¤šä¸€ç‚¹ï¼Œä½†è¯´å®è¯ï¼Œå¯¼å‡ºcsv æ˜¯æœ€å¸¸è§çš„äº†ã€‚

![](../images/Pasted%20image%2020230103083041.png)



### å¯¼å‡ºåˆ°Blobæ–‡ä»¶

é‚£ä¹ˆï¼Œå¦‚æœæˆ‘æƒ³æŠŠæŸ¥è¯¢ç»“æœå¯¼å‡ºåˆ°äº‘ç«¯å‘¢ï¼Ÿé¦–å…ˆä½ éœ€è¦å‡†å¤‡ä¸€ä¸ªå®¹å™¨ï¼ˆContainerï¼‰ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªåŒ…å«äº† `Write` æƒé™çš„SAS URLã€‚

![](../images/Pasted%20image%2020230103083812.png)

```
.export async compressed to csv
Â  Â  (h'https://chenxizhang.blob.core.windows.net/data?sp=rw&st=2023-01-02T23:37:45Z&se=2023-01-03T07:37:45Z&spr=https&sv=2021-06-08&sr=c&sig=pxWNDEcr2tMzkXOp8iY%2F0RuZ8mLOsLUmJbyJq5kpn6A%3D') Â 
Â  Â  with (includeHeaders='all') Â  <|
Â  Â  StormEvents
Â  Â  | summarize
Â  Â  Â  Â  count = count(),
Â  Â  Â  Â  crops = sum(DamageCrops),
Â  Â  Â  Â  property= sum(DamageProperty)
Â  Â  Â  Â  by
Â  Â  Â  Â  State,
Â  Â  Â  Â  bin(StartTime, 1d)
```

æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ä¼šåœ¨ç›®æ ‡çš„å®¹å™¨ä¸­ç”Ÿæˆä¸€ä¸ªéšæœºçš„æ–‡ä»¶ï¼ˆä»¥.csv.gz ä¸ºæ‰©å±•åï¼‰ï¼Œä½ ç”šè‡³è¿˜å¯ä»¥ä¸ºä¸€ä¸ªæŸ¥è¯¢ç”Ÿæˆå¤šä¸ªæ–‡ä»¶ï¼ˆå³æŒ‰ä¸€å®šçš„å¤§å°è‡ªåŠ¨æ‹†åˆ†æ–‡ä»¶ï¼‰ï¼Œåªè¦è®¾ç½® sizeLimit çš„é€‰é¡¹å€¼å°±å¯ä»¥äº†ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚


```
.export async compressed to csv
Â  Â  (h'https://chenxizhang.blob.core.windows.net/data?sp=rw&st=2023-01-02T23:37:45Z&se=2023-01-03T07:37:45Z&spr=https&sv=2021-06-08&sr=c&sig=pxWNDEcr2tMzkXOp8iY%2F0RuZ8mLOsLUmJbyJq5kpn6A%3D') Â 
Â  Â  with (
Â  Â  includeHeaders='all',
Â  Â  sizeLimit =100000
Â  Â  ) Â  <|
Â  Â  StormEvents
Â  Â  | summarize
Â  Â  Â  Â  count = count(),
Â  Â  Â  Â  crops = sum(DamageCrops),
Â  Â  Â  Â  property= sum(DamageProperty)
Â  Â  Â  Â  by
Â  Â  Â  Â  State,
Â  Â  Â  Â  bin(StartTime, 1d)
```

æ–‡ä»¶åå¹¶ä¸é‡è¦ï¼Œå› ä¸ºå¦‚æœä½ ä»¥åå¯¼å…¥æ—¶ï¼Œå…¶å®ä¹Ÿä¸éœ€è¦çŸ¥é“å…·ä½“çš„æ–‡ä»¶åï¼Œåªè¦é€šè¿‡å®¹å™¨å¯¼å…¥å³å¯ã€‚è¿™çœŸæ˜¯å¤ªå¼ºå¤§äº†ã€‚

![](../images/Pasted%20image%2020230103084251.png)