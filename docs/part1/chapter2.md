# ç¬¬äºŒç« ï¼šKQL æ ¸å¿ƒ

> ä½œè€…ï¼šé™ˆå¸Œç« ï¼Œ2023å¹´1æœˆ äºä¸Šæµ· 
> ä¸“æ ï¼š**å¤§æ•°æ®åˆ†ææ–°ç©æ³•ä¹‹Kustoå®å…¸** ç¬¬ä¸€å­£ï¼šä¸€å…ƒåˆå§‹
> åé¦ˆï¼š[ares@xizhang.com](mailto:ares@xizhang.com)



è¿™ä¸€ç« å°†é‡ç‚¹å±•å¼€ KQL æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿæ˜¯è¿™ä¸€å­£çš„æ ¸å¿ƒå†…å®¹ï¼Œå› ä¸ºä½¿ç”¨Kusto æœ€æ ¸å¿ƒçš„ä»»åŠ¡å°±æ˜¯æŸ¥è¯¢æ•°æ®ã€‚å½“ç„¶ç”±äºKQL æœ¬èº«çš„å†…å®¹éå¸¸å¤šï¼ˆå‡½æ•°å’Œæ“ä½œç¬¦æœ‰å‡ ç™¾ä¸ªé‚£ä¹ˆå¤šï¼‰ï¼Œé™äºç¯‡å¹…ï¼Œæˆ‘ä»¬è‚¯å®šæ²¡æœ‰åŠæ³•é¢é¢ä¿±åˆ°ï¼ŒåŒæ—¶è€ƒè™‘åˆ°è¿™ä¸€å­£æ˜¯å…¥é—¨çš„çŸ¥è¯†ï¼Œæ‰€ä»¥ä¼šå°½é‡åŒ…æ‹¬æœ€åŸºæœ¬çš„éƒ¨åˆ†ï¼Œç›®æ ‡æ˜¯å¸Œæœ›è¯»è€…èƒ½å¿«é€ŸæŒæ¡ KQL å¹¶ä¸”ç”¨åˆ°æœ€å¸¸è§çš„æŸ¥è¯¢åœºæ™¯ä¸­å»ã€‚


## å†è®ºå¯å‘å¼å’Œæ¢ç´¢å¼

æˆ‘ä¸æ­¢ä¸€æ¬¡æåˆ° `å¯å‘å¼` å’Œ `æ¢ç´¢å¼` è¿™ä¸¤ä¸ªè¯ï¼Œè¿™æ˜¯ KQL ä¸ºæˆ‘å¸¦æ¥çš„æœ€å¤§æƒŠå–œã€‚è¿™ä¸¤ä¸ªæœ¯è¯­çš„æ„æ€æ˜¯æŒ‡ï¼Œä¸éœ€è¦å€ŸåŠ©ä»»ä½•é¢„å…ˆç¼–å†™çš„æ–‡æ¡£ï¼Œé€šè¿‡ KQL æœ¬èº«å°±å¯ä»¥ç”±æµ…è‡³æ·±åœ°äº†è§£æŸä¸ªæ•°æ®é›†ï¼Œå¹¶ä¸”åœ¨äº†è§£è¿‡ç¨‹ä¸­ï¼Œä¸æ–­åœ°å¾—åˆ°å¯å‘ï¼Œè€Œéšç€è¿™ç§æ¢ç´¢çš„æ¨è¿›ï¼Œä½ æœ€åå¯¹æ•°æ®é›†èƒ½çƒ‚ç†Ÿäºå¿ƒï¼Œæœ‰å¯èƒ½åšå‡ºä¸€äº›ä¹‹å‰éƒ½é¢„æƒ³ä¸åˆ°çš„åˆ†æåœºæ™¯ã€‚è¿™å¯èƒ½æ‰æ˜¯æ•°æ®åˆ†æçš„æœªæ¥ï¼Œä¹Ÿæ˜¯Kusto åŒºåˆ«äºå…¶ä»–ä¼ ç»Ÿæ•°æ®åˆ†æå·¥å…·çš„æ ¹æœ¬ã€‚

æ—¢ç„¶è¦å­¦ä¹ æ•°æ®æŸ¥è¯¢ï¼Œå½“ç„¶ç¦»ä¸å¼€æ•°æ®ã€‚åœ¨ç¬¬ä¸€ç« å…¶å®å·²ç»æåˆ°äº†å¦‚ä½•è¿æ¥åˆ°èŒƒä¾‹æ•°æ®åº“ ï¼ˆ[https://dataexplorer.azure.com/clusters/help/databases/Samples](https://dataexplorer.azure.com/clusters/help/databases/Samples) ï¼Œå¹¶ä¸”è¿˜èœ»èœ“ç‚¹æ°´ä¸€æ ·åœ°ä»‹ç»äº†å‡ ä¸ªæŸ¥è¯¢ï¼Œå…¶ä¸­å·²ç»æåˆ°ä¸€ä¸ªè¡¨æ ¼ `StormEvents` , åŒ…å«äº†2007å¹´ç¾å›½å¢ƒå†…å‘ç”Ÿè¿‡çš„æ‰€æœ‰æš´é£é›¨çš„æ•°æ®ã€‚è¿™ä¸€ç« æˆ‘ä»¬ä¹Ÿå°†é‡ç‚¹ä½¿ç”¨è¿™ä¸ªè¡¨æ ¼æ¥ä½œä¸ºèŒƒä¾‹æ•°æ®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒå¤šä¸€ç‚¹äº†è§£ã€‚

### äº†è§£å…ƒæ•°æ®

æˆ‘ä»¬å°±ä»¥è¿™ä¸ªè¡¨ä¸ºä¾‹ï¼Œæ¥ä½“éªŒä¸€ä¸‹è¿™ç§å¯å‘å’Œæ¢ç´¢çš„è¿‡ç¨‹å§ã€‚å¦‚æœä½ æƒ³å¿«é€Ÿäº†è§£Kustoæ•°æ®åº“ä¸­çš„æŸä¸ªè¡¨çš„åŸºæœ¬æƒ…å†µï¼Œä½ å¯ä»¥é€šè¿‡æ‰§è¡Œä¸‹é¢çš„æ§åˆ¶å‘½ä»¤ã€‚

`.show table StormEvents`

> ğŸ“£æ§åˆ¶å‘½ä»¤éƒ½æ˜¯ä»¥ . å¼€å¤´çš„ï¼Œä»¥ä¾¿åŒºåˆ«äºKQL æŸ¥è¯¢ã€‚æœ¬ä¹¦æš‚æ—¶ä¸ä¼šå¯¹æ§åˆ¶å‘½ä»¤çš„ç»†èŠ‚è¿›è¡Œå±•å¼€ï¼Œä½ åªè¦åœ¨éœ€è¦æ—¶è·Ÿç€ä½¿ç”¨å®ƒä»¬å³å¯ã€‚

![](../images/Pasted%20image%2020230105134923.png)

è¿™é‡Œçš„ Attribute å…¶å®æŒ‡çš„å°±æ˜¯å­—æ®µ ï¼ˆColumnï¼‰ï¼Œé€šè¿‡ä¸Šè¡¨ä½ å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„å­—æ®µåç§°ï¼Œæ•°æ®ç±»å‹ï¼Œæ˜¯å¦åšäº†ç´¢å¼•æˆ–å‹ç¼©ï¼Œæ‰€å çš„å­˜å‚¨ç©ºé—´ï¼Œç”šè‡³è¿˜èƒ½çŸ¥é“å½“å‰ä½¿ç”¨çš„å¼•æ“ç‰ˆæœ¬ã€‚

è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œæˆ‘å»ºè®®ä½ èŠ±ä¸€ç‚¹æ—¶é—´è®¤çœŸçœ‹ä¸€ä¸‹å­—æ®µåç§°ï¼Œå¹¶ä¸”åœ¨ä½ çš„è„‘æµ·ä¸­å°è¯•å»ºç«‹å¯¹ä»–ä»¬çš„ä¸€ä¸ªç›´è§‚è®¤è¯†ï¼Œå¹¶ä¸”å¼€å§‹æƒ³è±¡ä»–ä»¬ä¼šæ˜¯ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œå¯ä»¥ç”¨æ¥äº§ç”Ÿå“ªäº›åˆ†æçš„åœºæ™¯å’Œæ•ˆæœã€‚ä¾‹å¦‚è¿™ä¸ªè¡¨ä¸­ï¼Œå®ƒæœ‰ä¸‹é¢çš„å­—æ®µï¼Œæˆ‘æŠŠæˆ‘åœ¨ç¬¬ä¸€çœ¼çœ‹åˆ°æ—¶çš„è”æƒ³ä¹Ÿè®°å½•ä¸‹æ¥ã€‚

| å­—æ®µå           | å«ä¹‰                       | è”æƒ³                                                                                           |
| ---------------- | -------------------------- | ---------------------------------------------------------------------------------------------- |
| StartTime        | å¼€å§‹æ—¶é—´                   | ç”¨æ—¶é—´æ®µæ¥åˆ†ææ˜¯æœ€å¸¸è§çš„                                                                       |
| EndTime          | ç»“æŸæ—¶é—´                   | ç»“æŸæ—¶é—´å¦‚æœå‡å»å¼€å§‹æ—¶é—´çš„è¯ï¼Œå¯ä»¥è®¡ç®—å¾—åˆ°æ—¶é•¿ï¼Œè€Œæ—¶é•¿ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¿¡æ¯                       |
| BeginLat         | å¼€å§‹çº¬åº¦                   | æœ‰ç»çº¬åº¦ä¿¡æ¯çš„è¯ï¼Œä¹Ÿè®¸å¯ä»¥ç”»åœ¨åœ°å›¾ä¸Š                                                           |
| BeginLon         | å¼€å§‹ç»åº¦                   | åŒä¸Š                                                                                           |
| EndLat           | ç»“æŸçº¬åº¦                   | åŒä¸Š                                                                                           |
| EndLon           | ç»“æŸç»åº¦                   | åŒä¸Š                                                                                           |
| BeginLocation    | å¼€å§‹çš„åœ°ç†ä½ç½®ï¼ˆæ–‡æœ¬è¡¨ç¤ºï¼‰ | è¿™ä¸ªå¯ä»¥ç”¨æ¥åšåˆ†ç±»ç»Ÿè®¡                                                                         |
| EndLocation      | ç»“æŸçš„åœ°ç†ä½ç½®ï¼ˆæ–‡æœ¬è¡¨ç¤ºï¼‰ | åŒä¸Š                                                                                           |
| State            | æ‰€å±çš„å·                   | åŒä¸Š                                                                                           |
| EventType        | äº‹ä»¶ç±»å‹                   | åŒä¸Š                                                                                           |
| Source           | æ•°æ®æ¥æº                   | åŒä¸Š                                                                                           |
| InjuriesDirect   | ç›´æ¥å—ä¼¤äººæ•°               | è¿™äº›æ˜¯åº¦é‡å€¼ï¼Œå¯ä»¥ç”¨æ¥æ˜¾ç¤ºç»Ÿè®¡å€¼ï¼Œè¶‹åŠ¿ç­‰                                                       |
| InjuriesIndirect | é—´æ¥å—ä¼¤äººæ•°               | åŒä¸Š                                                                                           |
| DeathsDirect     | ç›´æ¥æ­»äº¡äººæ•°               | åŒä¸Š                                                                                           |
| DeathsIndirect   | é—´æ¥æ­»äº¡äººæ•°               | åŒä¸Š                                                                                           |
| DamageProperty   | å—ç¾è´¢äº§æŸå¤±               | åŒä¸Š                                                                                           |
| DamageCrops      | å†œä½œç‰©æŸå¤±                 | åŒä¸Š                                                                                           |
| EpisodeId        | é£æš´çš„ä¸€ä¸ªé˜¶æ®µç¼–å·         | è¿™ä¸ªæœ‰æ„æ€ï¼Œä¹Ÿè®¸ä¸€ä¸ªé£æš´ï¼ŒåŒ…æ‹¬äº†å‡ ä¸ªé˜¶æ®µï¼Œä¾‹å¦‚å°é£å½¢æˆï¼Œæˆ–è€…å‡çº§ä¸ºå¼ºå°é£ï¼Œæœ€åé€€å»ç­‰           |
| EventId          | äº‹ä»¶çš„ç¼–å·                 | ä¸€ä¸ªé˜¶æ®µåˆåŒ…å«äº†å‡ ä¸ªäº‹ä»¶ï¼Œä¾‹å¦‚æŸä¸ªå°é£åœ¨å®æ³¢ç™»é™†ï¼Œç„¶ååœ¨èˆŸå±±ç™»é™†ï¼Œè¿™äº›å…·ä½“ç™»é™†å¯èƒ½å°±æ˜¯ä¸€ä¸ªäº‹ä»¶ |
| EpisodeNarrative | é˜¶æ®µæ•…äº‹æè¿°               | è¿™ä¸ªä¸€èˆ¬ç”¨ä¸åˆ°ï¼Œé™¤éæ˜¯æŒ‰å…³é”®å­—æœç´¢ç”¨                                                           |
| EventNarrative   | äº‹ä»¶æ•…äº‹æè¿°               | åŒä¸Š                                                                                           |
| StormSummary     | æ•´ä¸ªé£æš´çš„æ€»ç»“             | åŒä¸Š                                                                                           |

æ‰€ä»¥ï¼Œå…¶å®ä½ å¯ä»¥å½’ç±»ä¸€ä¸‹ï¼Œè¿™ä¸ªè¡¨ä¸­æœ‰æ—¶é—´ä¿¡æ¯ï¼ˆå¤šä¸ªæ—¶é—´å¯ä»¥ç»„æˆä¸€ä¸ªæ—¶é—´è½´ï¼Œæè¿°äº‹ä»¶å‘ç”Ÿçš„è½¨è¿¹ç­‰ï¼‰ï¼Œåœ°ç†ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç²¾å‡†çš„ç»çº¬åº¦ï¼Œä»¥åŠå…·ä½“çš„å·å¿ï¼‰ï¼Œåˆ†ç±»ä¿¡æ¯ï¼Œä»¥åŠæŸå¤±æ•°æ®ï¼ˆå¯ä»¥ç”¨æ¥åšèšåˆè®¡ç®—ç­‰ï¼‰ã€‚

æ¥ä¸‹æ¥ï¼Œä½ å¯èƒ½ä¼šæœ‰å…´è¶£äº†è§£ä¸€ä¸‹ï¼Œè¿™äº›ä¸ªå­—æ®µåˆ°åº•åŒ…å«äº†å¤šå°‘æ•°æ®å‘¢ï¼Œåˆ†åˆ«åœ¨åˆ†å¸ƒä¸Šæœ‰ä»€ä¹ˆç‰¹å¾å‘¢ï¼Ÿä½ å¯ä»¥å°è¯•ä¸€ä¸‹ `.show table StormEvents column statistics` è¿™ä¸ªå‘½ä»¤ã€‚

![](../images/Pasted%20image%2020230105143716.png)

é€šè¿‡è¿™ä¸ªç»“æœï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£ï¼Œè¿™ä¸ªè¡¨çš„è¡Œæ•°åº”è¯¥æœ‰ 59066ï¼Œ ç„¶åé’ˆå¯¹é‚£äº›ä¸æ˜¯å”¯ä¸€å€¼çš„å­—æ®µï¼ˆå‰”é™¤äº†æ—¶é—´å­—æ®µï¼Œåœ°ç†å­—æ®µç­‰ï¼‰ï¼Œä½ å¯ä»¥çœ‹åˆ°ä»–ä»¬å„è‡ªçš„åŸºæ•°ï¼ˆCardinalityï¼‰ï¼Œè¿™ä¸ªå¯ä»¥è¡¨ç¤ºæŸä¸ªåˆ—å”¯ä¸€å€¼çš„æ•°é‡ï¼Œä¾‹å¦‚ `State` è¿™ä¸ªå­—æ®µï¼Œå…¶å®å®ƒåªæœ‰ 67 ä¸ªå”¯ä¸€çš„å€¼ã€‚é€šè¿‡è¿™ä¸ªå€¼çš„å¤§å°ï¼ˆæˆ–è€…ä»–çš„èŒƒå›´ï¼‰ï¼Œä½ å¯ä»¥å¤§è‡´çŸ¥é“å“ªäº›å­—æ®µç”¨æ¥åšåˆ†ç±»æ±‡æ€»ä¼šæ›´åŠ åˆé€‚ã€‚é€šå¸¸ï¼Œè¿™ä¸ªå€¼è¶Šå°çš„è¯ï¼ŒæŸ¥è¯¢å’Œèšåˆè®¡ç®—çš„æ•ˆç‡éƒ½ä¼šæ›´é«˜ã€‚

ä¸Šè¡¨ä¸­è¿˜å¯ä»¥çœ‹å‡ºç©ºå€¼çš„è¡Œæ•°ï¼Œä»¥åŠå æ€»è¡Œæ•°çš„æ¯”ä¾‹ã€‚ç©ºå€¼çš„å•å…ƒæ ¼æ˜¯æ— æ³•é¿å…çš„ï¼Œä½†å®ƒä¼šå½±å“èšåˆè®¡ç®—ï¼Œæ‰€ä»¥ä½ éœ€è¦é¢å¤–å°å¿ƒç©ºå€¼æ¯”è¾ƒå¤šçš„å­—æ®µã€‚

å’±ä»¬ç»§ç»­æ¢ç´¢å§ã€‚é€šè¿‡ `.show table StormEvents details` , ä½ å¯ä»¥ä»å¦å¤–ä¸€ä¸ªä¾§é¢äº†è§£åˆ°è¿™ä¸ªè¡¨çš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚ç¼“å­˜çš„è§„åˆ™ï¼Œæ•°æ®å­˜å‚¨çš„è§„åˆ™ï¼Œåˆå¹¶ç­–ç•¥ç­‰ã€‚

![](../images/Pasted%20image%2020230105145137.png)

æœ‰ç‚¹æ„æ€ï¼Œå¦‚æœä½ è¿˜ä¸è¿‡ç˜¾ï¼Œå…¶å®è¿˜æœ‰æ›´å¤šå¯ä»¥æ¢ç´¢çš„ã€‚

![](../images/Pasted%20image%2020230105150843.png)

é™äºç¯‡å¹…æˆ‘ä»¬å°±ä¸ä¸€ä¸€å±•å¼€äº†ï¼Œç›®å‰æ¥è¯´å·²ç»å¤Ÿç”¨ã€‚æ¥ä¸‹æ¥æˆ‘å°±ä¼šå¯¹æ•°æ®è¿›è¡Œä¸€äº›æŠ½æ ·ï¼Œå®é™…åœ°è€ƒå¯Ÿä¸€ä¸‹ï¼Œåˆ°åº•åŒ…å«ä»€ä¹ˆæ ·çš„æ•°æ®ã€‚

### æ•°æ®å–æ · 

å–æ ·çš„æ„æ€å°±æ˜¯æˆ‘éšä¾¿çœ‹çœ‹ï¼Œä¸è¦å°çœ‹è¿™ç§æ¢ç´¢ï¼Œä½ å¯ä»¥å¿«é€Ÿåœ°æµè§ˆä¸€ä¸‹æ•°æ®ï¼Œç”šè‡³éšæœºæŠ½æ ·ï¼Œè¿™æ ·å¯ä»¥å¯¹æ•°æ®æœ‰ä¸€ä¸ªç›´è§‚çš„è®¤è¯†ï¼Œå¯ä»¥å¯å‘ä½ æ„æ€åç»­çš„åˆ†æã€‚

#### take, limit

è¿™ä¸¤ä¸ªæ“ä½œç¬¦ï¼ˆoperatorï¼‰å…¶å®æ˜¯ç­‰ä»·çš„ï¼Œå®ƒä»¬å°±æ˜¯ä»ç›®æ ‡æ•°æ®é›†ä¸­æŠ½å–æŒ‡å®šçš„è¡Œæ•°è¿”å›ã€‚æœ‰æ„æ€çš„æ˜¯ï¼Œæ¯æ¬¡æ‰§è¡Œçš„ç»“æœå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œé™¤éä½ çš„ç»“æœé›†æœ¬èº«æ˜¯æ’å¥½åºçš„ï¼Œä½†è¿™æ ·åšé€šå¸¸æ²¡æœ‰å¿…è¦ï¼Œæˆ‘ä»¬åè€Œæ˜¯å¸Œæœ›çœ‹åˆ°è¿™ç§éšæœºæ€§ã€‚

å¦‚ä¸‹ä¾‹å­ï¼Œæˆ‘åœ¨ä¸åŒçš„æµè§ˆå™¨çª—å£è¿è¡ŒåŒä¸€ä¸ªå‘½ä»¤ï¼Œçœ‹åˆ°çš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ã€‚

![](../images/Pasted%20image%2020230105151557.png)
![](../images/Pasted%20image%2020230105151710.png)

ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨åŒä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œä½ å¯èƒ½å‘ç°å¤šæ¬¡è¿è¡Œçš„è¯ï¼Œç»“æœå¯èƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™æ˜¯å› ä¸ºå½“å‰è¿™ä¸ªsession ä¼šæœ‰ç¼“å­˜çš„åŸå› ã€‚Kustoæ—¢ç„¶å¦‚æ­¤èªæ˜ï¼Œå®ƒä¸ä¼šç¬¨åˆ°æ—¢ç„¶çŸ¥é“ä½ åªæ˜¯ä¸ºäº†å–æ ·ï¼Œè€Œæ¯æ¬¡éƒ½çœŸçš„æ‰§è¡ŒæŸ¥è¯¢çš„ã€‚

> å¦‚æœç»“æœé›†æœ¬èº«æ˜¯æ’å¥½åºçš„ï¼Œé‚£ä¹ˆæ¯æ¬¡åªä¼šå–æœ€å¼€å§‹çš„æŒ‡å®šè¡Œæ•°ï¼Œè¿™æ˜¯èƒ½å¾—åˆ°ä¸€è‡´çš„ç»“æœçš„ã€‚æœ‰å…´è¶£ä½ å¯ä»¥å°è¯•ä¸€ä¸‹ `StormEvents | order by StartTime asc Â | take 10` ã€‚

#### sample, rand

sample è·Ÿ takeçš„åŒºåˆ«åœ¨äºï¼Œå®ƒæ°¸è¿œæ˜¯éšæœºè¿”å›æŒ‡å®šçš„è¡Œæ•°ï¼Œè€Œä¸æ˜¯ä»å¤´éƒ¨å¼€å§‹å–ã€‚è¯·å°è¯•åœ¨ä¸åŒçª—å£æ‰§è¡Œ  `StormEvents | Â sample 10` ã€‚

é™¤äº†æŒ‡å®šä¸€ä¸ªç²¾ç¡®çš„è¿”å›è¡Œæ•°ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰æ—¶å€™ä¼šæƒ³ï¼Œèƒ½å¦ç»™æˆ‘è¿”å›å·®ä¸å¤š1%çš„æ•°æ®å§ã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡ rand è¿™ä¸ªæ“ä½œç¬¦æ¥å®ç°ã€‚

`StormEvents | where rand() < 0.01`

![](../images/Pasted%20image%2020230105154021.png)

rand è¿™ä¸ªæ“ä½œç¬¦æœ¬èº«æ˜¯ç”¨æ¥äº§ç”Ÿä¸€ä¸ªéšæœºæ•°çš„ï¼Œä½†è¿™é‡Œçš„ç”¨æ³•æ›´å¦™ã€‚

#### distinct, sample-distinct

å¦å¤–ä¸€ä¸ªå¸¸è§çš„æ¢ç´¢æ•°æ®çš„åœºæ™¯ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³äº†è§£ä¸€ä¸‹æŸä¸ªåˆ—å…·ä½“æœ‰å“ªäº›å¯ç”¨çš„å€¼ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ç”¨ `distinct` æ“ä½œç¬¦äº†ã€‚ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå¤šä¸ªåˆ—ï¼Œ `distinct` å°†è¿”å›è¿™å¤šä¸ªåˆ—ç»„åˆèµ·æ¥ä¸é‡å¤çš„å€¼ã€‚

![](../images/Pasted%20image%2020230105154235.png)

distinct ä¼šè¿”å›æ‰€æœ‰çš„ä¸é‡å¤å€¼ã€‚é‚£ä¹ˆï¼Œå¦‚æœä½ æƒ³åœ¨å…¶ä¸­éšæœºæŒ‘é€‰å‡ ä¸ªå‡ºæ¥ï¼Œå°±å¯ä»¥ç”¨ `sample-distinct` äº†ï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚

![](../images/Pasted%20image%2020230105154351.png)

#### count, max, min

åœ¨è¿›è¡Œæ•°æ®æ¢ç´¢æ—¶ï¼Œæˆ‘è¿˜ç»å¸¸å¸Œæœ›äº†è§£æŸä¸ªå­—æ®µçš„è¡Œæ•°ï¼Œæœ€å¤§å€¼å’Œæœ€å°å€¼ä¹‹ç±»çš„ã€‚è¿™æ—¶å€™ä¼šç”¨åˆ° count, max, min è¿™å‡ ä¸ªèšåˆå‡½æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å®ä¾‹ã€‚

`StormEvents | summarize count(), max(StartTime), min(StartTime)`

![](../images/Pasted%20image%2020230105155155.png)

æ•°æ®çš„æ¢ç´¢éƒ¨åˆ†å°±åˆ°è¿™é‡Œã€‚ä¸‹é¢æˆ‘ä»¬ä»å‡ ä¸ªä¸åŒçš„è§’åº¦æ¥é€æ­¥å±•å¼€æ•°æ®æŸ¥è¯¢çš„åŸºæœ¬ç”¨æ³•ã€‚

## ä¸¤ä¸ªæ³¨æ„äº‹é¡¹

å¼€å§‹ä¹‹å‰ï¼Œæˆ‘å¸Œæœ›ä½ å¯¹ Kusto çš„æŸ¥è¯¢çš„ä¸¤ä¸ªæ³¨æ„äº‹é¡¹æœ‰æ‰€äº†è§£ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š

1. **Kusto æ–‡æœ¬æ˜¯åŒºåˆ†å¤§å°å†™çš„**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ A æ˜¯ä¸ç­‰äº a çš„ï¼Œ å¾ˆå¯èƒ½è¿™æ˜¯ä¸ºäº†æé«˜æ€§èƒ½è€Œè¿™ä¹ˆè®¾è®¡çš„ã€‚è¿™ä¸ªè¦æœ‰ä¸€ä¸ªå¿ƒç†å‡†å¤‡ï¼Œå¦‚æœå¸Œæœ›å¿½ç•¥å¤§å°å†™çš„è¯ï¼Œä¼šæœ‰ä¸€äº›ç‰¹æ®Šçš„è¿ç®—ç¬¦ã€‚
	1. ä¾‹å¦‚ =~ ï¼ˆç­‰äºè¿ç®—ï¼Œä¸”ä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œ æˆ– !~ (ä¸ç­‰äºè¿ç®—ï¼Œä¸”ä¸åŒºåˆ†å¤§å°å†™) ç­‰ç­‰ã€‚
2. **Kusto ä¸­å¯¹äºæ—¥æœŸå’Œæ—¶é—´å¤„ç†ï¼Œéƒ½æ˜¯å°†å…¶è§†ä½œ UTC æ—¶é—´çš„**ã€‚è¿™ä¸ªåœ¨ [[ç¬¬ä¸€ç«  - Kusto ç®€ä»‹#æ—¶åŒºè®¾ç½®]] å°èŠ‚æœ‰åšäº†ä»‹ç»ï¼Œæ›´æ”¹ä¸ªäººè®¾ç½®ä¸­æ˜¯æ—¶åŒºå°†æ”¹å˜æ˜¾ç¤ºæ•ˆæœï¼Œä½†ä¸ä¼šæ”¹å˜æ•°æ®æœ¬èº«ã€‚
	1. æœ‰ä¸¤ä¸ªå‡½æ•°å¯ä»¥è½¬æ¢ UTC æ—¶é—´å’Œæœ¬åœ°æ—¶é—´ï¼Œå®ƒä»¬æ˜¯ `datatime_utc_to_local`  å’Œ `datetime_local_to_utc`ï¼Œ ä½ å¯ä»¥åœ¨æŸ¥è¯¢ä¸­çœŸæ­£éœ€è¦æ—¶ç”¨å®ƒã€‚

## æ•°æ®è¿‡æ»¤å’Œæœç´¢

åœ¨æ•°æ®æŸ¥è¯¢ä¸­ï¼Œé¦–å½“å…¶å†²çš„å°±æ˜¯å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤æˆ–è€…æœç´¢ã€‚å› ä¸ºKusto æ˜¯ä¸€ä¸ªå¤§æ•°æ®åˆ†æå·¥å…·ï¼Œæ‰€ä»¥ä½ ä¸å¯èƒ½æ¯æ¬¡éƒ½é’ˆå¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œæ‰«ææˆ–è®¡ç®—ï¼Œé‚£æ—¢ä¸æ˜¯æ˜æ™ºï¼Œä¹Ÿä¸æ˜¯æœ‰å¿…è¦çš„ã€‚

è¿™ä¸€èŠ‚æˆ‘ä»¬å°†åˆ†äº«å¦‚ä½•ç”¨ `where` å’Œ `search`ï¼Œ`find` æ“ä½œç¬¦å®ç°çµæ´»ç­›é€‰å’Œæœç´¢ã€‚

### where, filter

å¦‚æœè¦ç»Ÿè®¡æ‰€æœ‰çš„Kusto æŸ¥è¯¢ï¼Œæˆ‘æ•¢æ‹…ä¿ `where` è¿™ä¸ªæ“ä½œç¬¦çš„ä½¿ç”¨ç‡è‚¯å®šæ˜¯ååˆ—å‰èŒ…çš„ã€‚å®ƒçš„åŸºæœ¬ç”¨æ³•å¯èƒ½å¤§å®¶ä¹Ÿéƒ½å¾ˆç†Ÿæ‚‰ï¼Œåœ¨ `where` åé¢è·Ÿä¸Šä¸€ä¸ªæ–­è¨€è¡¨è¾¾å¼ï¼ˆ_Predicate_ï¼‰ï¼Œå¦‚æœè¯¥æ–­è¨€è¿”å› trueï¼Œåˆ™è¡¨ç¤ºæ»¡è¶³ç­›é€‰æ¡ä»¶ã€‚

>ğŸ“£ filter æ˜¯ where çš„åŒä¹‰è¯ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ–­è¨€å¯ä»¥æ˜¯ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªï¼Œè€Œä¸”å¤šä¸ªæ–­è¨€ä¹‹é—´å¯ä»¥ç”¨ `and` æˆ– `or` ç»„åˆèµ·æ¥ã€‚ä¸‹é¢æœ‰å‡ ä¸ªå®ä¾‹ã€‚

```
// åªæœ‰ä¸€ä¸ªæ–­è¨€çš„ç­›é€‰
StormEvents
| where State == "UTAH"

// æœ‰å¤šä¸ªæ–­è¨€çš„ç­›é€‰
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation

// åŒæ ·å¤šä¸ªæ–­è¨€ï¼Œä½†åˆ†å¼€å¤šä¸ªwhereè¯­å¥ï¼Œå…¶å®ä¹Ÿç›¸å½“äºæ˜¯ and çš„æ•ˆæœ
StormEvents
| where DamageProperty > 0
| where EventType == "Flood"
| where BeginLocation != EndLocation

// æœ‰å¤šä¸ªæ–­è¨€ï¼Œä½†å› ä¸ºæ˜¯ or çš„å…³ç³»ï¼Œä¸èƒ½ç®€å•æ‹†åˆ†ä¸ºå¤šä¸ªwhere è¯­å¥
StormEvents
| where State == 'UTAH' or DeathsDirect > 0

```

ä¸€èˆ¬æˆ‘ä»¬ç†è§£çš„æ–­è¨€è¡¨è¾¾å¼ï¼Œéƒ½æ˜¯ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„ï¼Œå·¦ä¾§æ˜¯å¾…æ£€æµ‹çš„å€¼ï¼ˆå­—æ®µï¼‰ï¼Œä¸­é—´æ˜¯æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå³ä¾§æ˜¯ç”¨æ¥æ¯”è¾ƒçš„å€¼ã€‚ä½†æ˜¯ `where` è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç”¨æ³•ï¼Œå°±æ˜¯å·¦ä¾§ç”¨ `*` æ¥è¡¨ç¤ºæ‰€æœ‰å­—æ®µï¼Œè¿™å°±æœ‰ç‚¹ç±»ä¼¼äºå…¨æ–‡æ£€ç´¢äº†ï¼Œè¯·æ³¨æ„ï¼Œè¿™ç§æƒ…å†µåªé€‚åˆå¯¹æ–‡æœ¬å­—æ®µè¿›è¡Œæ¯”è¾ƒã€‚

>ğŸ“£æœ¬èŠ‚åé¢è¿˜ä¼šè®²åˆ°å¦å¤–ä¸€ä¸ªsearchæ“ä½œç¬¦ï¼Œä¹Ÿæ˜¯å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚

```
StormEvents
| where * has 'UTAH'
```

ä¸è¦å¤ªè¿‡äºæ‹…å¿ƒå…¨æ–‡æ£€ç´¢çš„æ€§èƒ½ï¼ŒKusto å¯¹äºæ–‡æœ¬çš„å…¨æ–‡æ£€ç´¢æä¾›äº†ä¼˜åŒ–ã€‚

åœ¨äº†è§£äº† `where` çš„åŸºæœ¬ç»“æ„åï¼Œä½ å°±ä¼šæ˜ç™½çœŸæ­£é‡è¦çš„æ˜¯ä¸åŒçš„æ•°æ®ç±»å‹æ”¯æŒä¸åŒçš„æ¯”è¾ƒè¿ç®—ã€‚ä¸‹é¢é’ˆå¯¹ä¸»è¦çš„æ•°æ®ç±»å‹åšä¸€äº›å±•å¼€è¯´æ˜ã€‚

##### æ—¥æœŸæ¯”è¾ƒè¿ç®—

å¸¸è§çš„æ—¥æœŸæ¯”è¾ƒæ— å¤–ä¹å°±æ˜¯ä»¥ä¸‹ä¸¤ç§
1. åœ¨ï¼ˆä¸åœ¨ï¼‰æŸä¸ªæ—¶é—´æ®µä¹‹å†…
2. å¤§äºæˆ–å°äºã€(ä¸ï¼‰ç­‰äºæŸä¸ªæ—¶é—´

ç¬¬ä¸€ç§éœ€æ±‚ï¼Œç”¨ `between` å’Œ `!between` å³å¯ï¼Œè€Œç¬¬äºŒç§éœ€æ±‚ï¼Œä¹Ÿæ˜¯å¾ˆç›´ç™½åœ°ï¼Œç”¨ `>`ï¼Œ`>=` ï¼Œ`<`ï¼Œ`<=` ï¼Œ`==` ï¼Œ `!=` å³å¯ã€‚

ä½†æ˜¯è¿™é‡Œé‡è¦çš„æ˜¯ï¼Œå³ä¾§ç”¨æ¥æ¯”è¾ƒçš„å€¼ï¼Œæ€ä¹ˆè¡¨ç¤ºæˆä¸€ä¸ªæ—¥æœŸæ•°æ®ï¼ˆdatetime, date, time)ï¼Ÿå®ƒæ¶‰åŠåˆ°ä¸€äº›å¾ˆæœ‰æ„æ€çš„å‡½æ•°ã€‚

| å‡½æ•°          | ä½œç”¨                           | èŒƒä¾‹                                                          |
| ------------- | ------------------------------ | ------------------------------------------------------------- |
| datetime      | å°†ä¸€ä¸ªæ•°å€¼è½¬æ¢ä¸ºæ—¥æœŸ           | datetime(1970-1-1), datetime('1970-1-1 20:00:04')             |
| todatetime    | åŒä¸Šï¼Œæ¨èä½¿ç”¨datetime         | todattime(1970-1-1)                                           |
| make_datetime | è¾“å…¥å¹´æœˆæ—¥ç­‰å‚æ•°æ¥ç”Ÿæˆä¸€ä¸ªæ—¥æœŸ | make_datetime(2001,1,1)                                       |
| ago           | è¿‡å»çš„ä¸€ä¸ªæ—¥æœŸæˆ–æ—¶é—´           | ago(1d) è¡¨ç¤ºæ˜¨å¤©ï¼Œ ago(1h) è¡¨ç¤ºè¿‡å»ä¸€å°æ—¶ï¼Œ ago(-1d) è¡¨ç¤ºæ˜å¤© |
| now           | ç°åœ¨æˆ–æœªæ¥çš„æ—¥æœŸæˆ–æ—¶é—´         | now() è¡¨ç¤ºç°åœ¨ï¼Œ now(2d) è¡¨ç¤ºåå¤©ï¼Œ now(-1d) è¡¨ç¤ºæ˜¨å¤©         |

æˆ‘ä»¬æœ‰äº›æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä¿å­˜çš„æ—¥æœŸæ—¶é—´æ˜¯ä¸€ç§æ‰€è°“çš„ unixtimeï¼Œå®ƒçœ‹èµ·æ¥æ˜¯ä¸€ä¸²æ•°å­—ï¼Œé€šå¸¸æ˜¯æŒ‡ä» 1970å¹´1æœˆ1æ—¥çš„é›¶ç‚¹åˆ°ç°åœ¨çš„ç§’æ•°ï¼Œä¾‹å¦‚ 1546897531 ï¼Œé‚£ä¹ˆæ€ä¹ˆæŠŠè¿™æ ·ä¸€ä¸ªæ•°å€¼è½¬æ¢ä¸ºæ—¥æœŸç±»å‹å‘¢ï¼Ÿä½ å¯ä»¥ä½¿ç”¨ `unixtime_seconds_todatetime` å‡½æ•°ï¼Œä¾‹å¦‚ `print date_time = unixtime_seconds_todatetime(1546897531)`ã€‚

å¦‚æœè¦æŠŠä¸€ä¸ªæ—¥æœŸè½¬æ¢ä¸º unixtimeï¼Œåˆ™å¯ä»¥ä½¿ç”¨ `(datetime(2023-1-2)-datetime(1970-1-1))/1s`ï¼Œ å¾—åˆ°çš„ç»“æœä¸º 1672617600ã€‚

æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ `between` çš„ç”¨æ³•ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒçš„å‚æ•°ä¸ºä¸¤ä¸ªæ—¥æœŸæ—¶é—´å€¼ï¼Œä¾‹å¦‚

```
StormEvents
| where StartTime between (datetime(2007-1-1) ..datetime(2007-2-1))
```

ä½†ä¹Ÿè¿˜æœ‰ä¸€ä¸ªå†™æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ª `timespan` çš„è¯­æ³•ï¼Œä¸Šé¢æåˆ°çš„ 1d, 1h å…¶å®éƒ½æ˜¯æ‰€è°“çš„`timespan` çš„è¯­æ³•ã€‚

```
StormEvents
| where StartTime between (datetime(2007-1-1) ..1d)
```

##### æ–‡æœ¬æ¯”è¾ƒè¿ç®—

æ–‡æœ¬çš„æ¯”è¾ƒè¿ç®—åœ¨ Kusto ä¸­æ˜¯éå¸¸ä¸°å¯Œçš„ï¼Œä¸‹é¢æœ‰ä¸€ä¸ªå®Œæ•´çš„è¡¨æ ¼ã€‚æˆ‘æœ€å¸¸ç”¨çš„æœ‰ `==` ï¼Œ `has`  è¿™ä¸¤ä¸ªï¼Œä½†å…¶å®æ¯ä¸€ä¸ªéƒ½å€¼å¾—äº†è§£ä¸€ä¸‹ã€‚

è¯·æ³¨æ„ï¼Œå¸¦æœ‰ `~` åç¼€çš„è¿ç®—ç¬¦æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œè€Œå¸¦æœ‰ `_cs` åç¼€çš„ï¼Œåˆ™æ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚

![](../images/Pasted%20image%2020230105162834.png)

åœ¨KustoæŸ¥è¯¢ä¸­ï¼Œä½ å¯ä»¥ç”¨ä¸¤ä¸ªå•å¼•å·ï¼ˆ`'`) å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸¤ä¸ªåŒå¼•å·ï¼ˆ`"`ï¼‰ï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ã€‚è¿™ä¸ªåœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¹Ÿæ˜¯å¦‚æ­¤è®¾è®¡ã€‚æˆ‘ä¹ æƒ¯ç”¨å•å¼•å·ï¼Œå› ä¸ºè¿™æ ·è¾“å…¥æ›´å¿«ä¸€ç‚¹ï¼Œä½ ä¸éœ€è¦æŒ‰ä½ `Shift` é”®æ¥è¾“å…¥åŒå¼•å·ã€‚å¦å¤–ï¼Œåœ¨å•å¼•å·å®šä¹‰çš„å­—ç¬¦ä¸²ä¸­ï¼Œå¯ä»¥æœ‰åŒå¼•å·ï¼Œåä¹‹äº¦ç„¶ã€‚


##### æ•°å€¼æ¯”è¾ƒè¿ç®—

æ•°å€¼æ¯”è¾ƒè¿ç®—ç›¸å¯¹ç®€å•ï¼Œäº‹å®ä¸Šå®ƒè·Ÿæ—¥æœŸå¾ˆç±»ä¼¼ï¼Œå¯ä»¥ç”¨ `between` å’Œ `!between` æ¥åˆ¤æ–­æ˜¯å¦åœ¨ä¸€ä¸ªè¿ç»­çš„èŒƒå›´ï¼Œä¹Ÿå¯ä»¥ç›´ç™½åœ°ï¼Œç”¨ `>`ï¼Œ`>=` ï¼Œ`<`ï¼Œ`<=` ï¼Œ`==` ï¼Œ `!=` å³å¯ï¼Œå½“ç„¶è¿˜å¯ä»¥ç”¨ `in`ï¼Œ `!in` æ¥æ¯”è¾ƒæ˜¯å¦åœ¨ä¸€ä¸ªä¸è¿ç»­çš„åˆ—è¡¨å€¼ä¸­ã€‚

##### æ€§èƒ½å»ºè®®

æœ‰å‡ æ¡ä¸€èˆ¬æ€§çš„å»ºè®®ï¼Œå¯ä»¥ç”¨æ¥æå‡ç­›é€‰æ•°æ®çš„æ€§èƒ½

1. å°½é‡ä¸è¦åœ¨æ¯”è¾ƒè¿ç®—ç¬¦çš„ä¸¤ä¾§è¿˜æœ‰å€¼è®¡ç®—çš„è¡¨è¾¾å¼ã€‚æœ€ç†æƒ³çš„æŸ¥è¯¢æ˜¯å·¦ä¾§ä¸ºå­—æ®µåï¼Œå³ä¾§ä¸ºä¸€ä¸ªå¸¸é‡ã€‚ä¾‹å¦‚ `where State == 'UTAH'` ã€‚å¦‚æœç¡®å®æ¶‰åŠåˆ°è¿ç®—ï¼Œå¯ä»¥è€ƒè™‘ç”¨ `let` è¯­å¥å®šä¹‰å®ƒï¼Œç„¶ååœ¨ `where` å­å¥ä¸­å¼•ç”¨è¿™ä¸ªå˜é‡ã€‚

	```
	let avgDeaths = toscalar (StormEvents | summarize avg( DeathsDirect));
	StormEvents
	| where DeathsDirect > avgDeaths
	```

	è¿™è¦æ¯”ä¸‹é¢è¿™æ ·çš„æŸ¥è¯¢å¥½å¾—å¤šã€‚
	
	```
	StormEvents
	| where DeathsDirect > toscalar (StormEvents | summarize avg( DeathsDirect))
	```

3. æŒ‰å¤æ‚æ€§ä»ä½åˆ°é«˜è¿›è¡Œç­›é€‰æ’åºã€‚ä¾‹å¦‚ä¸‹é¢çš„æŸ¥è¯¢ï¼Œæœ‰ä¸‰ä¸ªæ¡ä»¶ï¼Œé€šå¸¸æ•°å€¼å‹å¤æ‚æ€§ä¼šå°äºæ–‡æœ¬å‹ï¼Œè€Œæœ€åé‚£ä¸ªæ˜¯æ›´å¤æ‚ï¼Œå› ä¸ºä¸¤ä¾§éƒ½æ²¡æœ‰å¸¸é‡ã€‚
	```
	StormEvents
	| where DamageProperty > 0
	    and EventType == "Flood"
	    and BeginLocation != EndLocation
	```

2. è¿‡æ»¤è¡Œæ•°æ›´å¤šçš„æ¡ä»¶æ”¾åœ¨å‰é¢ã€‚å¦‚æœæœ‰æ—¶é—´è¿‡æ»¤çš„æ¡ä»¶ï¼Œå°½å¯èƒ½æ”¾åœ¨æœ€å‰é¢ï¼Œå› ä¸ºKusto é’ˆå¯¹æ—¶é—´æœ‰ä¸“é—¨çš„ä¼˜åŒ–ã€‚

### search

search æ˜¯ä¸€ä¸ªç¥å¥‡çš„æ“ä½œç¬¦ï¼Œå®ƒåŸºæœ¬ä¸Šå°±ç›¸å½“äº Kusto ç‰ˆæœ¬çš„å…¨æ–‡æ£€ç´¢å¼•æ“å§ã€‚å®ƒå¯ä»¥åœ¨æ•´ä¸ªè¡¨ï¼ˆç”šè‡³æ•´ä¸ªæ•°æ®åº“ä¸­ï¼‰æœç´¢æ–‡æœ¬ï¼Œæ”¯æŒé€šé…ç¬¦ï¼Œä¹Ÿæ”¯æŒå¤§å°å†™æ•æ„Ÿã€‚

æœ‰ä¸¤ç§å¸¸è§çš„ç”¨æ³•ï¼Œåˆ†åˆ«æ˜¯

1. ä»¥è¡¨ä¸ºèµ·ç‚¹ï¼Œä½œä¸ºç±»ä¼¼ `where` çš„æ“ä½œç¬¦è¿›è¡Œä½¿ç”¨ï¼Œæœç´¢å‘ç”Ÿåœ¨å½“å‰è¡¨çš„èŒƒå›´ä¹‹å†…ã€‚
2. ç›´æ¥ä½œä¸ºé¡¶çº§è¯­å¥ï¼Œå¯ä»¥åœ¨æ•°æ®åº“ï¼Œæˆ–è€…æŒ‡å®šè¡¨ä¸­æœç´¢ã€‚

#### ä»¥è¡¨ä¸ºèµ·ç‚¹æœç´¢


```
// æ‰«ææ•´ä¸ªè¡¨ï¼Œåªè¦ä»»ä½•ä¸€åˆ—åŒ…å«UTAHå°±æ»¡è¶³æ¡ä»¶

StormEvents
| search "UTAH"

// ç‰¹åˆ«é™å®š Stateå­—æ®µè¦ç­‰äº UTAH æ‰æ»¡è¶³æ¡ä»¶ï¼Œè¿™ä¸ªå°±ç›¸å½“äº where State =='UTAH' äº†
StormEvents
| search State == 'UTAH'

// ç‰¹åˆ«é™å®š Stateå­—æ®µåŒ…å« UTAH å°±æ»¡è¶³æ¡ä»¶ï¼Œè¿™ä¸ªå°±ç›¸å½“äº where State has 'UTAH' äº†
StormEvents
| search State:'UTAH'

// å¤šä¸ªæ¡ä»¶éšæ„ç»„åˆ
StormEvents
| search State:'UTAH' and ('P*' or '*h')

// å¤šä¸ªæ¡ä»¶ç»„åˆï¼Œå¹¶ä¸”å¤§å°å†™æ•æ„Ÿ
StormEvents
| search kind=case_sensitive State:'UTAH' or ('P*' or '*h')
```

è¿™ä¸ªç»“æœé›†ä¼šå¤šå‡ºæ¥ä¸€ä¸ªå­—æ®µï¼Œ `$table` æ˜¾ç¤ºè¡¨çš„åç§°ã€‚

![](../images/Pasted%20image%2020230105213404.png)


#### è‡ªç”±æœç´¢

è¿™ç§æœç´¢å°±æ›´ç‰›äº†ã€‚å®ƒç”šè‡³å¯ä»¥åœ¨æ•´ä¸ªæ•°æ®åº“ä¸­éšä¾¿æœç´¢ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šå¤šä¸ªè¡¨ã€‚ä¸è¿‡ï¼Œæ®æˆ‘è§‚å¯Ÿï¼Œé€Ÿåº¦å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œæ…é‡ä½¿ç”¨ã€‚

```
// åœ¨æ•´ä¸ªæ•°æ®åº“ä¸­æ‰€æœ‰è¡¨ä¸­æœç´¢ åŒ…å« UTAH çš„è®°å½•
search 'UTAH'

// åœ¨æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­æœç´¢ åŒ…å«UTAHçš„è®°å½•
search in ( StormEvents, ConferenceSessions) 'UTAH'

// åœ¨æŒ‡å®šçš„ StormEvents ä»¥åŠCå¼€å¤´çš„è¡¨ä¸­æœç´¢åŒ…å«UTAHçš„è®°å½•
search in ( StormEvents, C*) 'UTAH'

// åœ¨æŒ‡å®šçš„ StormEvents ä»¥åŠCå¼€å¤´çš„è¡¨ä¸­æœç´¢åŒ…å«UTAH å’Œä»¥På­—ç¬¦å¼€å¤´çš„è®°å½•
search in ( StormEvents, C*) 'UTAH' and 'P*'
```

å¦‚æœæ¶‰åŠåˆ°å¤šè¡¨æŸ¥è¯¢ï¼Œè¿”å›çš„ç»“æœé›†ä¼šæŠŠå¤šä¸ªè¡¨çš„å­—æ®µéƒ½åˆå¹¶èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå¾ˆå¤§çš„åˆé›†ã€‚å¹¶ä¸”ç¬¬ä¸€ä¸ªå­—æ®µåŒæ ·ä¸º `$table` ï¼Œä¹Ÿå°±æ˜¯è¡¨çš„åç§°ã€‚

![](../images/Pasted%20image%2020230105212456.png)

### find

è¿™ä¸ªæ›´æœ‰æ„æ€ã€‚å®ƒå¾ˆåƒ `search` çš„ç¬¬äºŒç§ç”¨æ³•ï¼Œä¸è¿‡å®ƒçš„è¿”å›å€¼ä¸ä¸€æ ·ã€‚

#### å½“å‰æ•°æ®åº“æŸ¥æ‰¾

```
find in (*) where State == 'UTAH' or InjuriesDirect >1
```
findçš„ç»“æœé›†é™¤äº†ä¼šåˆ—å‡ºæ¡ä»¶åˆ—ï¼ˆä¾‹å¦‚ä¸Šé¢çš„ State å’Œ InjuriesDirectï¼‰ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªåˆ—ï¼Œsource_ è¡¨ç¤ºæ¥æºè¡¨ï¼Œè€Œ pack_ åˆ™è¡¨ç¤ºç¬¦åˆæ¡ä»¶çš„è¡Œçš„ä¸€ä¸ªæ‰“åŒ…çš„ç»“æœï¼Œå®ƒä¼šç”¨ä¸€ä¸ª `json` æ ¼å¼è¡¨ç¤ºã€‚è¿™ä¸ªåœ¨Kusto ä¸­å…¶å®å«åš `dynamic` æ•°æ®ç±»å‹ã€‚

![](../images/Pasted%20image%2020230105214318.png)

#### è·¨æ•°æ®åº“æŸ¥æ‰¾

å®ƒè¿˜å¯ä»¥è·¨æ•°æ®åº“ï¼ˆç”¨databaseå…³é”®å­—ï¼‰ï¼Œè·¨ç¾¤é›†ï¼ˆç”¨ clusterå…³é”®å­—ï¼‰è¿›è¡Œæœç´¢ã€‚é¢çš„ç¥å•Šï¼ŒKusto ä½ å’‹ä¸ä¸Šå¤©å‘¢ï¼Ÿä¸‹é¢æ˜¯ä¸€äº›ç®€å•çš„

```
find in (Table1, Table2, Table3) where Fruit=="apple"
find in (database('*').*) where Fruit == "apple"
find in (cluster('cluster_name').database('MyDB*'.*)) where Fruit == "apple"
find in (cluster("cluster1").database("B*").K*, cluster("cluster2").database("C*".*))
where * has "Kusto"
```

## é€‰æ‹©æˆ–æ‰©å±•å­—æ®µ

å¦‚æœè¯´ç­›é€‰å’Œè¿‡æ»¤ã€æˆ–è€…æœç´¢ä¸€èˆ¬éƒ½æ˜¯ Kusto æŸ¥è¯¢çš„ç¬¬ä¸€æ­¥ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬é€šå¸¸å°±ä¼šå¯¹è¦è¿”å›çš„åˆ—è¿›è¡Œé€‰æ‹©ï¼Œæˆ–è€…åœ¨è¿™ä¸ªç»“æœé›†åŸºç¡€ä¸Šæ‰©å±•å‡ºæ–°çš„å­—æ®µã€‚

### é€‰æ‹©å­—æ®µ - project

å¦‚æœä½ å¯¹ä¼ ç»Ÿçš„æ•°æ®åº“æŸ¥è¯¢æœ‰äº›æ¦‚å¿µï¼Œå¯¹ `where` è¿™ä¸ªå­å¥è‚¯å®šä¸ä¼šé™Œç”Ÿï¼Œç„¶åè¿™ä¸€å°èŠ‚è¦è®²çš„é€‰æ‹©å­—æ®µï¼Œå…¶å®ç›¸å½“äºä»¥å‰çš„ `select` å­å¥ï¼Œåªä¸è¿‡ Kusto ç”¨ `project` è¿™ä¸ªæ“ä½œç¬¦ã€‚

project åœ¨è¿™é‡Œä¸æ˜¯æŒ‡ `é¡¹ç›®` çš„æ„æ€ï¼Œè€Œæ˜¯ `æŠ•å°„` çš„æ„æ€ï¼Œå·¥ä½œä¸­æˆ‘ä»¬å¦‚æœè¦æŠŠç”µè„‘ç”»é¢æŠ•åˆ°ä¸€ä¸ªå±å¹•ä¸Šï¼Œä¹Ÿä¼šç”¨ `project` è¿™ä¸ªåŠ¨è¯ã€‚

```
StormEvents
| where DamageProperty > 0
	and EventType == "Flood"
	and BeginLocation != EndLocation
| project DamageProperty, EventType, BeginLocation, EndLocation
```

![](../images/Pasted%20image%2020230106133236.png)

åœ¨æŠ•å°„çš„è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥å¯¹åˆ—è¿›è¡Œé‡å‘½åï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ã€‚

```
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation
| project ['Damage Property'] = DamageProperty, EventType, BeginLocation, EndLocation
```

è¿˜æœ‰ä¸€ä¸ªæ›´åŠ å­¦é™¢æ´¾çš„å†™æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ `project-rename` æ“ä½œç¬¦ã€‚

```
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation
| project DamageProperty, EventType, BeginLocation, EndLocation
| project-rename ['Damage Property'] = DamageProperty
```

æ•ˆæœå…¶å®æ˜¯ä¸€æ ·ï¼Œæ‰€ä»¥è®© `project` å°±å¹²æŠ•å°„çš„å·¥ä½œï¼Œä¹Ÿè®¸æ›´å¥½ä¸€äº›ã€‚

å¦‚æœä½ è¦ä¸€æ¬¡æ€§ `project` å¤šä¸ªå­—æ®µï¼Œä½†åˆä¸æƒ³ä¸€ä¸ªä¸€ä¸ªå­—æ®µåœ°åˆ—å‡ºæ¥ï¼Œä½ å¯ä»¥ç”¨ `project-keep` è¿™ä¸ªæ“ä½œç¬¦ï¼Œ å®ƒæ—¢å¯ä»¥æŒ‡å®šæ˜ç¡®çš„å­—æ®µåï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªèŒƒå¼è¡¨ç¤ºä¸€æ‰¹å­—æ®µï¼Œä¾‹å¦‚ä¸‹é¢ä¾‹å­åªä¿ç•™ State å’Œä»¥ B å¼€å¤´çš„å­—æ®µã€‚

```
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation
| project-keep State, B*
```

![](../images/Pasted%20image%2020230106134314.png)

åè¿‡æ¥ï¼Œå¦‚æœä½ æƒ³æ’é™¤ä¸€äº›åˆ—ï¼Œåˆ™å¯ä»¥ç”¨ `project-away` è¿™ä¸ªæ“ä½œç¬¦ã€‚

```
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation
| project-away State, B*
```

`project` å®¶æ—ç”šè‡³è¿˜æœ‰ä¸€ä¸ªå¯ä»¥å¯¹è¾“å‡ºåˆ—è¿›è¡Œæ’åºçš„æ“ä½œç¬¦ï¼Œå« `project-reorder`ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæ˜¯æŠŠ State å­—æ®µæ’åœ¨ç¬¬ä¸€ä¸ªï¼Œç„¶åå…¶ä»–çš„å­—æ®µï¼Œä»¥å­—æ¯å‡åºæ’åˆ—ã€‚

```
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation
| project-reorder State,* asc
```

è¿™é‡Œçš„æ’åºè§„åˆ™æœ‰ å‡åº `asc`ï¼Œ é™åº `desc` ï¼Œ å¤å¤å‡åº `granny-asc`ï¼Œ å¤å¤é™åº `granny-desc` å››ç§ã€‚å¤å¤è¿™ä¸ªç¿»è¯‘æ˜¯æˆ‘è‡ªå·±æƒ³å‡ºæ¥çš„ï¼Œå…¶å® granny çš„æ„æ€æ˜¯æŒ‡å®ƒåœ¨æ’åºæ—¶è¿˜ä¼šè€ƒè™‘åç§°ä¸­çš„æ•°å­—éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è®© a100 è¿™ä¸ªå­—æ®µï¼Œå‡ºç°åœ¨ a20 ä¹‹åï¼Œé‚£ä¹ˆå°±è¦ç”¨ `granny-asc` ï¼ˆå› ä¸º100>20)ï¼Œ å¦‚æœä½ ç”¨æ ‡å‡†çš„ `asc` ï¼Œå®ƒä¼šå°è¯•ç”¨å­—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥ a100 ä¼šå‡ºç°åœ¨ a20 ä¹‹å‰ï¼Œå› ä¸º 1<2ã€‚


### æ‰©å±•å­—æ®µ - extend

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ç»“æœé›†ä¸­å¸Œæœ›æ·»åŠ è‡ªå·±çš„è®¡ç®—å­—æ®µã€‚è¿™ç§è¡Œä¸ºå…¶å®å«åšæ‰©å±•å­—æ®µï¼Œè€Œåœ¨Kusto ä¸­å°±æ˜¯ç”¨ `extend` è¿™ä¸ªæ“ä½œç¬¦æ¥å®ç°çš„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ extend å°±æ˜¯æ‰©å±•çš„æ„æ€ï¼Œæ‰€ä»¥æˆ‘åœ¨åºè¨€ä¸­æåˆ°è¿‡ï¼ŒKusto ä¹‹æ‰€ä»¥è·Ÿä»¥å‰çš„æŸ¥è¯¢ä¸ä¸€æ ·ï¼Œæ˜¯å› ä¸ºå®ƒçš„è¯­æ³•éå¸¸ç›´è§‚ï¼Œç¬¦åˆç›´è§‰ï¼Œä¹Ÿè·Ÿè‹±è¯­çš„å£è¯­å¾ˆåƒï¼Œæ‰€ä»¥ä½ åœ¨å†™ä¸€ä¸ªæŸ¥è¯¢ï¼Œå°±å¥½åƒåœ¨è¯´è¯ä¸€æ ·ã€‚

```
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation
| extend TotalDamage = DamageCrops + DamageProperty
```

è¿™ä¸ªæŸ¥è¯¢ä¼šåœ¨åŸæœ‰ç»“æœé›†çš„åŸºç¡€ä¸Šï¼Œåœ¨æœ€åé¢æ·»åŠ ä¸€ä¸ªæ–°çš„åˆ—å«åš `TotalDamage` ï¼Œè€Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªè¿ç®—çš„ç»“æœã€‚

`extend` æ“ä½œç¬¦å¯ä»¥ä¸€æ¬¡æ€§æ‰©å±•å¤šä¸ªåˆ—ï¼Œåªè¦ç”¨é€—å·åˆ†å¼€å³å¯ã€‚

å…¶å®ï¼Œå‰é¢è®²åˆ°çš„ `project` ä¹Ÿå¯ä»¥ç”¨æ¥æ·»åŠ ä¸€ä¸ªæ–°çš„åˆ—ï¼Œå¹¶ä¸”èµ‹äºˆå®ƒä¸€ä¸ªè¿ç®—çš„ç»“æœã€‚

```
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation
| project TotalDamage = DamageCrops + DamageProperty
```

ä½†ç”±äº `project` çš„è¯­ä¹‰æ˜¯ `æŠ•å°„`ï¼Œ è€Œä¸æ˜¯æ‰©å±•æˆ–è€…è¿½åŠ ï¼Œæ‰€ä»¥ä¸Šé¢è¿™ä¸ªæŸ¥è¯¢ï¼Œåªä¼šè¿”å›ä¸€ä¸ªåˆ—ï¼Œè€Œä¸æ˜¯æ‰€æœ‰åˆ— + è¿™ä¸ªæ–°çš„åˆ—ã€‚

æˆ‘å±•ç¤ºè¿™ä¸ªä¾‹å­ï¼Œåªæ˜¯å‘Šè¯‰å¤§å®¶å¾ˆå¤šæ“ä½œç¬¦ä¹Ÿè®¸èƒ½åšç±»ä¼¼çš„äº‹æƒ…ï¼Œä½†æœ¬è´¨ä¸Šä»–ä»¬è¿˜æ˜¯æœ‰äº›ç»†å¾®å·®åˆ«çš„ï¼Œåªæœ‰ä½ æ·±åˆ»äº†è§£äº†å®ƒçš„è¯­ä¹‰ï¼Œçµæ´»è¿ç”¨å®ƒæ‰èƒ½èæ±‡è´¯é€šã€‚

### æ¡ä»¶è®¡ç®— - case

æ­¤å‰çš„ä¾‹å­å·²ç»çœ‹å‡ºï¼Œåœ¨ `project` å’Œ `extend` è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å®ç°è®¡ç®—å­—æ®µï¼Œè¿™å½“ç„¶å°±åŒ…å«äº†åŠ å‡ä¹˜é™¤ï¼Œä»¥åŠè¿˜æœ‰å¾ˆå¤šçš„å‡½æ•°ã€‚è¿™é‡Œä¸åšé€ä¸€çš„è®²è§£ï¼Œä½†æˆ‘æƒ³ä»‹ç»ä¸€ä¸ªæœ€å¸¸ç”¨çš„æ¡ä»¶è®¡ç®—çš„å‡½æ•° `case`ã€‚

```
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation
| project
Â  Â  State,
Â  Â  StartTime,
Â  Â  EndTime,
Â  Â  Level = case(
Â  Â  Â  Â  Â  Â  DamageCrops > 1000,
Â  Â  Â  Â  Â  Â  'High',
Â  Â  Â  Â  Â  Â  DamageCrops > 500,
Â  Â  Â  Â  Â  Â  'Medium',
Â  Â  Â  Â  Â  Â  'Low'
Â  Â  Â  Â  )
```

`case` å¯ä»¥æ ¹æ®ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰è¡¨è¾¾å¼è¿›è¡Œè¿ç®—ï¼Œç„¶ååŒ¹é…ä¸åŒçš„å€¼ï¼Œå¦‚æœå…¨éƒ¨æ²¡æœ‰åŒ¹é…åˆ°ï¼Œåˆ™è¿”å›æœ€åçš„é‚£ä¸ªå€¼ï¼ˆä¹Ÿç§°ä¸ºé»˜è®¤å€¼ï¼‰ï¼Œè¿™ä¸ªè®¾è®¡å¾ˆåƒå¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­çš„ `switch` è¯­å¥ã€‚

å¦‚æœä½ çš„æ¡ä»¶è®¡ç®—æ¯”è¾ƒç®€å•ï¼Œä¾‹å¦‚åªæ˜¯éæ­¤å³å½¼çš„äºŒåˆ†æ³• ï¼ˆif this then that) ï¼Œä½ é™¤äº†ç”¨ `case` è¿˜å¯ä»¥ç”¨ `iff` å‡½æ•°ã€‚

```
StormEvents
| where DamageProperty > 0
Â  Â  and EventType == "Flood"
Â  Â  and BeginLocation != EndLocation
| project
Â  Â  State,
Â  Â  StartTime,
Â  Â  EndTime,
Â  Â  Level = iff(DamageCrops > 1000, 'High', 'Normal')
```


## æ±‡æ€»ç»Ÿè®¡åˆ†æ

åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•å¯¹æºæ•°æ®è¿›è¡Œç­›é€‰å’Œè¿‡æ»¤ï¼Œç„¶åè¿›è¡Œå­—æ®µé€‰æ‹©æˆ–è€…æ‰©å±•ï¼Œä»¥ä¾¿ä»…è¾“å‡ºæˆ‘ä»¬éœ€è¦çš„å­—æ®µï¼ˆè¿™æœ‰åŠ©äºæé«˜æ€§èƒ½ï¼‰ï¼Œä½†è¿™æ ·çš„ç»“æœå…¶å®è¿˜æ˜¯åŸå§‹æ•°æ®ï¼Œå¯¹äºå¤§æ•°æ®åˆ†ææ¥è¯´ï¼Œå½“ç„¶ä¸ä¼šæ»¡è¶³äºæ­¤ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦å¯¹é½è¿›è¡Œæ±‡æ€»ç»Ÿè®¡åˆ†æï¼Œè¿™å°±éœ€è¦ç”¨åˆ° `summarize` äº†ã€‚


### æ±‡æ€»ç»Ÿè®¡ - summarize

ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ã€‚ `summarize` æ“ä½œç¬¦çš„åŸºæœ¬è¯­æ³•ç»“æ„å°±æ˜¯ï¼ŒæŒ‡å®šè¦æ±‡æ€»çš„è¡¨è¾¾å¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼‰, ç„¶åæŒ‡å®šè¦æŒ‰ä»€ä¹ˆè¿›è¡Œåˆ†ç±»æ±‡æ€»ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå­—æ®µï¼Œæˆ–å¤šä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè®¡ç®—ç»“æœï¼‰ã€‚å½“ç„¶ï¼Œæ­£å¦‚ä½ çœ‹åˆ°çš„ï¼Œä½ å¯ä»¥é‡å‘½åè¦è¿”å›çš„åˆ—çš„æ ‡é¢˜ã€‚

```
StormEvents
| summarize
Â  Â  Count = count(),
Â  Â  TotalDamage = sum(DamageCrops) + sum(DamageProperty)
Â  Â  by State
```

è¿è¡Œæ­¤æŸ¥è¯¢å¯ä»¥å¾—åˆ°æ¯ä¸ªå·çš„æš´é£é›¨å‘ç”Ÿçš„æ¬¡æ•°ï¼Œä»¥åŠæ€»çš„è´¢äº§æŸå¤±æ•°é‡ï¼Œä¸ç®¡æ˜¯å†œä½œç‰©è¿˜æ˜¯è´¢äº§æŸå¤±ã€‚

![](../images/Pasted%20image%2020230106142140.png)

è¿™é‡Œçš„å…³é”®æ˜¯ç†Ÿç»ƒæŒæ¡å„ç§èšåˆå‡½æ•°ï¼Œä¸‹è¡¨åˆ—å‡ºäº†æ‰€æœ‰çš„ç»Ÿè®¡èšåˆå‡½æ•°ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„ã€‚

![](../images/Pasted%20image%2020230106143947.png)

åœ¨è¿™é‡Œæˆ‘ä¸“é—¨ä»‹ç»ä¸€ä¸ªåœ¨ä¸šåŠ¡åˆ†æä¸­å¾ˆæœ‰ç”¨çš„ä¸€ä¸ªç»Ÿè®¡å‡½æ•°ï¼Œ`percentile` ï¼Œå®ƒç”¨æ¥è¿”å›ä¸€ç»„æ•°æ®çš„ç™¾åˆ†ä½ä¼°è®¡å€¼ã€‚


#### percentile, percentiles

ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€æ‰¹æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæš´é£é›¨å¸¦æ¥çš„æŸå¤±ã€‚è€Œæˆ‘ä»¬æƒ³è¦çŸ¥é“ï¼Œå¤§éƒ¨åˆ†çš„æ¡ˆä¾‹æœ‰å¤šå°‘æŸå¤±ã€‚å…·ä½“æ¥è¯´ï¼Œä¾‹å¦‚æˆ‘ä»¬æƒ³é—®ï¼Œ90% çš„æ¡ˆä¾‹æ˜¯å¤šå°‘æŸå¤±ä»¥ä¸‹å‘¢ï¼Ÿè¿™åœ¨ä¸šåŠ¡åˆ†æä¸­å°±æ˜¯è¦è®¡ç®— `P90` ã€‚

```
StormEvents
| summarize percentile(DamageCrops,90) by State
```

é€šè¿‡è°ƒæ•´ç¬¬äºŒä¸ªå‚æ•°å€¼ï¼Œä½ è¿˜å¯ä»¥å¾—åˆ°P50, P75, P99ç­‰ï¼Œåªè¦ä½ æ„¿æ„éƒ½å¯ä»¥ã€‚

![](../images/Pasted%20image%2020230106145804.png)

å½“ç„¶ï¼Œå¦‚æœä½ çœŸçš„æ˜¯æƒ³ä¸€æ¬¡æ€§è®¡ç®—å¤šä¸ª percentileï¼Œä½ å¯ä»¥ç›´æ¥ç”¨ `percentiles` è¿™ä¸ªèšåˆå‡½æ•°å³å¯ã€‚

```
StormEvents
| summarize
Â  Â  percentiles(DamageCrops, 50, 75, 95, 99)
Â  Â  by State
```

è¿™ç±»å‡½æ•°åœ¨ä¼°ç®—ç½‘ç»œå»¶æ—¶ï¼ˆlatencyï¼‰æˆ–è€…ååé‡ï¼ˆthroughputï¼‰æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå½“ç„¶å®ƒæœ¬è´¨ä¸Šæ˜¯å¯ä»¥ç”¨åœ¨ä»»æ„æ•°æ®ä¸Šé¢çš„ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒå¿«é€Ÿäº†è§£è¿™äº›æ•°æ®çš„åˆ†æ•£æƒ…å†µã€‚

å…³äºèšåˆå‡½æ•°çš„æ›´å¤šç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒ https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/aggregation-functions ã€‚


### ä½¿ç”¨ bin è¿›è¡Œåˆ†ç»„ï¼ˆåˆ†æ¡¶ï¼‰

åœ¨æ±‡æ€»ç»Ÿè®¡åˆ†æä¸­ï¼Œç¬¬ä¸€é‡è¦çš„éƒ¨åˆ†æ˜¯èšåˆå‡½æ•°ï¼Œç¬¬äºŒé‡è¦çš„éƒ¨åˆ†å°±æ˜¯åˆ†ç»„è¡¨è¾¾å¼äº†ã€‚ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ç”¨æŸä¸ªå­—æ®µæ¥ä½œä¸ºåˆ†ç»„çš„ã€‚ä½†ä¹Ÿæœ‰å…¶ä»–ä¸€äº›åœºæ™¯ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹ç›®æ ‡å­—æ®µè¿›è¡Œè¿›ä¸€æ­¥åˆ†ç»„ï¼Œä¾‹å¦‚å¦‚æœæ˜¯ä¸€ä¸ªæ—¶é—´å­—æ®µï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æŒ‰ç…§å°æ—¶èšåˆï¼Œæˆ–è€…å¤©ï¼Œå‘¨ç­‰ç­‰ã€‚åœ¨Kustoä¸­ï¼Œè¿™å¯ä»¥é€šè¿‡ `bin` å‡½æ•°æ¥å®ç°ï¼Œå®ƒå°±æ˜¯åˆ†æ¡¶çš„æ¦‚å¿µã€‚

è¿™ä¸ªåˆ†ç»„å°¤å…¶é€‚åˆäº `æ•°å€¼å‹ (int, long, real, decimal)`ï¼Œ`æ—¥æœŸå‹(date, time, datetime)`ï¼Œ`æ—¶é—´æ®µ (timespan)`ç±»å‹çš„å­—æ®µã€‚

```
StormEvents
| summarize
Â  Â  count() by bin( StartTime, 1d)
```

è¿™ä¸ªä¾‹å­æ˜¯ä»¥ StartTime è¿™ä¸ªå­—æ®µ ï¼ŒæŒ‰ç…§æ¯å¤©è¿›è¡Œèšåˆï¼Œç»Ÿè®¡å‘ç”Ÿæš´é£é›¨çš„æ¬¡æ•°ã€‚

![](../images/Pasted%20image%2020230106150900.png)

é’ˆå¯¹éæ—¥æœŸæ•°æ®ï¼Œå¦å¤–ä¸¤ä¸ªå‡½æ•°å¯èƒ½ä¹Ÿæ¯”è¾ƒæœ‰ç”¨ã€‚ ä»–ä»¬æ˜¯ `bin_at` å›ºå®šå¤§å°åˆ†æ¡¶ï¼Œä»¥åŠ `bin_auto` è‡ªåŠ¨åˆ†æ¡¶ã€‚

`bin_at` æ˜¯è§„å®šæ¯ä¸ªæ¡¶é‡Œé¢å¯ä»¥æœ‰å¤šå°‘ä¸ªå€¼ï¼Œç„¶åå†æŒ‰ç…§è¿™äº›å€¼è¿›è¡Œåˆ†ç±»æ±‡æ€»ã€‚ä¾‹å¦‚

```
StormEvents
| summarize count() by bin_at( DamageCrops, 500, 0)
```

![](../images/Pasted%20image%2020230106152556.png)

è€Œ bin_auto å¯èƒ½å°±æ˜¯ bin_at çš„ä¸€ä¸ªç‰¹æ®Šç‰ˆæœ¬å§ã€‚å®ƒé€šè¿‡åœ¨æŸ¥è¯¢ä¹‹å‰è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡æ¥å®ç°è‡ªåŠ¨åˆ†æ¡¶ï¼Œè¿™æ ·åœ¨æ¯æ¬¡æ‰§è¡Œ bin_auto æ—¶å°±ä¸éœ€è¦å•ç‹¬å†æŒ‡å®šäº†ã€‚

```
set query_bin_auto_size = 10;
StormEvents
| summarize count() by bin_auto(DamageCrops)
```

## æ’åº

åœ¨å‰é¢ä»‹ç» `bin_at` è¿™ä¸ªå‡½æ•°æ—¶ï¼Œä½ å¯èƒ½å‘ç°è¿”å›çš„ç»“æœä¸­ï¼Œ DamageCrops æ˜¯æ²¡æœ‰æ’åºçš„ï¼Œæ˜¾å¾—æ¯”è¾ƒä¹±ï¼Œä¹Ÿä¸åˆ©äºåç»­çš„å›¾è¡¨å±•ç¤ºã€‚å¦‚æœæ˜¯ä¸‹é¢è¿™æ ·å°±ä¼šå¥½å¾ˆå¤šã€‚

#### sort, order

![](../images/Pasted%20image%2020230106153432.png)

æ‰€ä»¥ï¼Œåœ¨ Kusto æŸ¥è¯¢ä¸­ï¼Œä½ ç»å¸¸ä¹Ÿä¼šç”¨åˆ°æ’åºæ“ä½œç¬¦ï¼Œä»–ä»¬å°±æ˜¯ `sort` æˆ– `order` æ“ä½œç¬¦ã€‚ä½ å¯ä»¥é’ˆå¯¹ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—æ®µè¿›è¡Œæ’åºï¼Œæ’åºè§„åˆ™æœ‰ `asc` å’Œ `desc` ï¼Œ å¦‚æœè¯¥åˆ—æœ‰ç©ºå€¼ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡  `nulls first` è¿˜æ˜¯ `nulls last` æ¥å†³å®šç©ºå€¼æ˜¯æ˜¾ç¤ºåœ¨æœ€å‰é¢å‘¢ï¼Œè¿˜æ˜¯åœ¨æœ€åé¢ã€‚

#### topï¼Œtop-nested

æˆ‘ä»¬ä¸€èˆ¬æ’åºåæœ‰å¯èƒ½è¿˜éœ€è¦æ˜¾ç¤ºå‰å‡ åï¼Œè¿™ä¸ªæ—¶å€™ä½ å½“ç„¶å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„è¯­æ³• â€”â€” ç»“åˆ `order` å’Œ `take` æ¥è·å–å‰åä¸ªæ•°æ®ã€‚

![](../images/Pasted%20image%2020230106153928.png)

ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥æ›´åŠ ç®€å•åœ°ä½¿ç”¨ `top` è¯­å¥æ¥å®ç°åŒæ ·çš„ç›®çš„ã€‚

![](../images/Pasted%20image%2020230106154031.png)

è¿˜æœ‰ä¸€ç§ä½ å¯èƒ½å¾ˆæƒ³å®ç°çš„åœºæ™¯ï¼Œä¾‹å¦‚ä½ æƒ³çŸ¥é“åœ¨é€ æˆæŸå¤±æœ€å¤§çš„å‰ä¸‰ä¸ªå·ä¸­ï¼Œ å‘ç”Ÿçš„æ¬¡æ•°æœ€å¤šçš„å‰åä¸ªæš´é£é›¨ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

```
StormEvents
| top-nested 3 of State by sum(DamageCrops) + sum(DamageProperty),
top-nested 10 of EventType by count()
```

![](../images/Pasted%20image%2020230106154448.png)

ä¸å¯æ€è®®ï¼Œéš¾ä»¥ç½®ä¿¡å§ï¼Œä½ å¯ä»¥å†™ä»»æ„å¤šå±‚åµŒå¥—å‘¢ï¼Œåªè¦ä½ èƒ½çœ‹æ‡‚å°±è¡Œã€‚

## å¤šè¡¨æŸ¥è¯¢

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å†™è¿‡çš„è¿™ä¹ˆå¤šæŸ¥è¯¢å¤§å¤šéƒ½åªæ˜¯é’ˆå¯¹ä¸€ä¸ªè¡¨ï¼Œå°¤å…¶æ˜¯ç»å¤§éƒ¨åˆ†éƒ½æ˜¯é’ˆå¯¹ `StormEvents` è¿™ä¸ªè¡¨è¿›è¡Œæ“ä½œã€‚ä½†å®é™…æƒ…å†µï¼Œä½ å‡ ä¹ä¸€å®šä¼šç”¨åˆ°å¤šä¸ªè¡¨çš„æ•°æ®ï¼Œä¸ç®¡æ˜¯åœ¨å¤šä¸ªè¡¨ä¸­è¿›è¡Œè”åˆæŸ¥æ‰¾ï¼Œè¿˜æ˜¯åˆå¹¶å¤šä¸ªæŸ¥è¯¢ç»“æœé›†ã€‚

ä¸ºäº†å®ç°å¤šè¡¨æŸ¥è¯¢ï¼Œä½ éœ€è¦ç”¨åˆ° `join` æˆ– `lookup`ï¼Œä¸ºäº†å®ç°ç»“æœé›†åˆå¹¶ï¼Œä½ éœ€è¦ç”¨åˆ° `union`ã€‚

#### join, lookup

åœ¨æˆ‘ä»¬çš„èŒƒä¾‹æ•°æ®åº“ä¸­ï¼Œ`StormEvents` è¿™ä¸ªè¡¨ä¿å­˜äº†æ¯ä¸ªå·å‘ç”Ÿçš„æš´é£é›¨æ¡ˆä¾‹çš„æ•°æ®ï¼Œå¦å¤–æœ‰ä¸€å¼ è¡¨ `PopulationData` åˆ™ä¿å­˜äº†æ¯ä¸ªå·çš„äººå£æ•°é‡ã€‚

![](../images/Pasted%20image%2020230106163929.png)

é‚£ä¹ˆï¼Œæˆ‘ç°åœ¨è¦ç”¨ä¸€ä¸ªæŸ¥è¯¢ï¼Œç»Ÿè®¡æ¯ä¸ªå·çš„æš´é£é›¨çš„æ¬¡æ•°ï¼Œå¹¶ä¸”ä¹Ÿæƒ³è¦åŒæ—¶æ˜¾ç¤ºå®ƒçš„äººå£æ•°é‡ã€‚è¿™å°±éœ€è¦å°†ä¸¤ä¸ªè¡¨çš„æ•°æ®é€šè¿‡å·ï¼ˆStateï¼‰è¿™ä¸ªå­—æ®µè¿æ¥èµ·æ¥ï¼Œè€Œä¸”è¿˜è¦æŠŠç»“æœé›†åˆå¹¶èµ·æ¥ï¼ˆæ¨ªå‘çš„ï¼‰ã€‚

```
StormEvents
| summarize count() by State
| join kind=inner PopulationData on State
```

![](../images/Pasted%20image%2020230106164149.png)

ç­‰ä¸€ä¸‹ï¼Œä½ å·²ç»çœ‹åˆ°ï¼Œç»“æœé›†ä¼šæœ‰å››ä¸ªåˆ—ï¼Œè€Œä¸”ç¬¬ä¸‰ä¸ªåˆ—æ˜¯ `State1`ï¼Œè¿™æ˜¯å› ä¸ºä¸¤ä¸ªè¡¨éƒ½æœ‰ State å­—æ®µï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªå°±ä¼šè‡ªåŠ¨å¤šä¸€ä¸ªæ•°å­—çš„åºå·ã€‚å¦‚æœæƒ³è¦æ‹¿æ‰è¿™ä¸ªåˆ—ï¼Œä½ å¯ä»¥ç”¨æ­¤å‰ä»‹ç»è¿‡çš„ `project-away` æ“ä½œç¬¦ã€‚

![](../images/Pasted%20image%2020230106164324.png)

`join` ï¼ˆè”æ¥ï¼‰æ”¯æŒå¤šç§æ–¹å¼ï¼Œé€šè¿‡ `kind` æ¥å®šä¹‰ï¼Œè¯·å‚è€ƒä¸‹è¡¨çš„è¯´æ˜ã€‚

![](../images/Pasted%20image%2020230106164525.png)
![](../images/Pasted%20image%2020230106165031.png)

å¦å¤–ï¼Œåœ¨ `on` å­å¥åé¢ï¼Œå¦‚æœä¸¤ä¸ªè¡¨éƒ½æœ‰åŒæ ·çš„å­—æ®µåï¼Œè€Œä¸”ä½ å°±æ˜¯æƒ³ç”¨è¿™ä¸ªå­—æ®µæ¥è”æ¥çš„è¯ï¼Œå¯ä»¥ç›´æ¥ `on` è¿™ä¸ªå­—æ®µï¼Œè€Œå¦‚æœä¸¤ä¸ªè¡¨çš„å­—æ®µåæ˜¯ä¸åŒçš„ï¼Œåˆ™å¯ä»¥ç”¨ `$left` å¼•ç”¨å·¦è¡¨ï¼Œ `$right` å¼•ç”¨å³è¡¨ï¼Œå¹¶ä¸”æŒ‡å®šè¦è¿›è¡Œè”æ¥çš„å…·ä½“å­—æ®µåå³å¯ã€‚

```
StormEvents
| summarize count() by State
| join kind=inner PopulationData on $left.State == $right.OtherColumn
| project-away OtherColumn
```

è·Ÿ `join` å¾ˆç±»ä¼¼çš„ä¸€ä¸ªæ“ä½œç¬¦æ˜¯ `lookup` ï¼Œä¸Šé¢çš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡å†™ä¸ºä¸‹é¢è¿™æ ·ã€‚

```
StormEvents
| summarize count() by State
| lookup PopulationData on Â State
```

ä½ ä¼šçœ‹åˆ°è¿™ä¸ªè¯­æ³•æ›´ç®€å•ï¼Œè€Œä¸”è¾“å‡ºçš„ç»“æœé›†ï¼Œä¹Ÿä¸ä¼šæœ‰é‡å¤çš„åˆ—ï¼Œ

![](../images/Pasted%20image%2020230106165226.png)

é‚£ä½ å¯èƒ½ä¼šé—®ï¼Œä»–ä»¬åˆ°åº•æœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿæˆ‘çš„ç†è§£å‘¢ï¼Œ`lookup` æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ `join`ï¼Œé¦–å…ˆå®ƒçš„ `kind` åªæœ‰ä¸¤ç§ï¼Œ `inner` å’Œ `leftouter` , å¦å¤–ä½ ä¹Ÿçœ‹åˆ°äº†ï¼Œå®ƒçš„è¯­æ³•å’Œè¿”å›ç»“æœéƒ½æ›´ç®€å•ã€‚

ä»æ€§èƒ½è§’åº¦æ¥è¯´ï¼Œå¦‚æœä½ ç”¨ `join` ï¼Œé‚£ä¹ˆå·¦è¡¨æœ€å¥½æ˜¯æ›´å°çš„ä¸€ä¸ªè¡¨ã€‚è€Œå¦‚æœä½ ç”¨ `lookup`ï¼Œå·¦è¡¨å¯ä»¥å¾ˆå¤§ï¼ˆé€šå¸¸æ˜¯äº‹å®è¡¨ï¼‰ï¼Œå³è¡¨åˆ™éœ€è¦å°ä¸€äº›ï¼ˆé€šå¸¸æ˜¯ç»´åº¦è¡¨ï¼‰ã€‚

#### union

å¦‚æœæˆ‘ä»¬éœ€è¦å°†å¤šä¸ªç»“æœé›†åˆå¹¶èµ·æ¥ï¼Œä¸ç®¡æ˜¯ä½œä¸ºæœ€ç»ˆç»“æœè¾“å‡ºï¼Œè¿˜æ˜¯ä½œä¸ºæ•°æ®æºè¿›ä¸€æ­¥è¿›è¡ŒåŠ å·¥ï¼Œä½ éƒ½å¯ä»¥åˆ©ç”¨ `union` è¿™ä¸ªæ“ä½œç¬¦è½»æ¾å®Œæˆã€‚

	æœ¬ä¾‹è¯·åˆ‡æ¢åˆ° SampleLogs è¿™ä¸ªèŒƒä¾‹æ•°æ®åº“ã€‚

```
RawSysLogs
| union SecurityLogs
| take 100
```

![](../images/Pasted%20image%2020230106171023.png)

å¦‚æœä½ æƒ³åœ¨ç»“æœé›†ä¸­æ˜¾ç¤ºè¡¨çš„åå­—ï¼Œå¯ä»¥æ·»åŠ  `withsource` çš„è®¾ç½®ï¼Œä¾‹å¦‚

![](../images/Pasted%20image%2020230106171145.png)


å¦‚æœä½ å¸Œæœ›æŠŠ `union` çš„ç»“æœä½œä¸ºæ•°æ®æºï¼Œè€Œä¸æ˜¯æœ€åçš„ç»“æœï¼Œåˆ™å¯ä»¥ç”¨ä¸‹é¢è¿™æ ·çš„æŸ¥è¯¢ï¼Œå°† `union` ä½œä¸ºé¡¶çº§æ“ä½œç¬¦ä½¿ç”¨ã€‚

```
union withsource=table RawSysLogs, SecurityLogs
| take 100
```


![](../images/Pasted%20image%2020230106171518.png)

å¦‚æœä½ çš„æ•°æ®åº“ä¸­è¦å¥½å¤šåç§°å¾ˆç±»ä¼¼çš„è¡¨ï¼ˆæˆ–è€…è§†å›¾ï¼‰ï¼Œä¾‹å¦‚ `sales2021`ï¼Œ `sales2022` è¿™æ ·çš„æ ¼å¼ï¼Œè€Œä½ éœ€è¦ä¸€æ¬¡æ€§åœ°æŠŠä»–ä»¬ `union` èµ·æ¥ï¼Œå¯ä»¥ç”¨ `union sales*` è¿™æ ·çš„è¯­æ³•ã€‚

> ä¸è¦ä»¥ä¸ºä¸ä¼šæœ‰è¿™æ ·çš„è¡¨ï¼ˆæˆ–è§†å›¾ï¼‰ï¼Œäº‹å®ä¸Šè¿™å¾ˆå¸¸è§ã€‚å› ä¸ºå¦‚æœä½ çš„æ•°æ®é‡çœŸçš„å¾ˆå¤§ï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™ç§éœ€æ±‚ï¼Œå®šæœŸå¯¹æ•°æ®è¿›è¡Œé¢„å…ˆèšåˆè®¡ç®—ï¼Œç„¶åå•ç‹¬å­˜å‚¨èµ·æ¥ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç‰©åŒ–è§†å›¾ã€‚

å¤šè¡¨æŸ¥è¯¢çš„æ¥æºï¼Œå¯ä»¥æ˜¯åŒä¸€ä¸ªæ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥ä¸åŒæ•°æ®åº“ï¼Œç”šè‡³ä¸åŒçš„ç¾¤é›†å‘¢ã€‚ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢ï¼Œè™½ç„¶å®é™…æ„ä¹‰ä¸æ˜¯å¾ˆå¤§ï¼Œä½†ä½ å¯ä»¥çœ‹åˆ°é€šè¿‡  `cluster` å‡½æ•°å¯ä»¥è®¿é—®åˆ°ä»»æ„çš„ç¾¤é›†ï¼Œ `database` å‡½æ•°å¯ä»¥è®¿é—®åˆ°ä»»æ„çš„æ•°æ®åº“ï¼Œå½“ç„¶ï¼Œå‰ææ˜¯ä½ å½“å‰çš„è´¦å·æ‹¥æœ‰å¿…è¦çš„æƒé™ã€‚

```
StormEvents
| top-nested 3 of State by sum(DamageCrops) + sum(DamageProperty),
top-nested 10 of EventType by count()
| union cluster('help').database('samples').StormEvents
| top-nested 3 of State by sum(DamageCrops) + sum(DamageProperty),
top-nested 10 of EventType by count()
```


å½“ç„¶ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥ä¸æ¥è‡ªäºæ•°æ®åº“ï¼Œè¯·çœ‹ä¸‹é¢çš„ç¤ºä¾‹ ï¼Œç¬¬äºŒä¸ªè¡¨çš„æ•°æ®å…¶å®æ˜¯æˆ‘ä»¬ç¡¬ç¼–ç åœ¨æŸ¥è¯¢ä¸­çš„ï¼Œè¿™é‡Œç”¨åˆ°äº† `datatable` è¿™ä¸ªæ“ä½œç¬¦ã€‚

```
StormEvents
| top-nested 3 of State by sum(DamageCrops) + sum(DamageProperty),
top-nested 10 of EventType by count()
| union (datatable (
Â  Â  State: string,
Â  Â  aggregated_State: long,
Â  Â  EventType: string,
Â  Â  aggregated_EventType: long
) [
Â  Â  "CALIFORNIA", long(2801954600), "Heavy Snow", long(187),
Â  Â  "CALIFORNIA", long(2801954600), "High Wind", long(168),
Â  Â  "CALIFORNIA", long(2801954600), "Drought", long(78),
Â  Â  "CALIFORNIA", long(2801954600), "Frost/Freeze", long(71),
Â  Â  "CALIFORNIA", long(2801954600), "Wildfire", long(67),
Â  Â  "CALIFORNIA", long(2801954600), "Strong Wind", long(60),
Â  Â  "CALIFORNIA", long(2801954600), "Flash Flood", long(42),
Â  Â  "CALIFORNIA", long(2801954600), "Excessive Heat", long(37)
])
```

ç±»ä¼¼çš„è¿˜æœ‰ `range` æ“ä½œç¬¦ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ç”Ÿæˆä¸€äº›æœ‰æ„æ€çš„æ•°æ®ï¼Œç”¨åˆ°ä½ çš„æŸ¥è¯¢ä¸­ã€‚

```
StormEvents
| take 1000
| join kind=inner(
Â  Â  range x from datetime(2007-1-1) to datetime(2007-1-10) step 10m)
Â  Â  on $left.StartTime == $right.x
```

## å¤šä¸ªç»“æœé›†

Kusto çš„æŸ¥è¯¢é€šå¸¸éƒ½åªè¿”å›ä¸€ä¸ªç»“æœé›†ï¼Œä½†åˆ©ç”¨ `fork` å’Œ `facet` ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªæŸ¥è¯¢è¾“å‡ºå¤šä¸ªç»“æœé›†ï¼Œä¸‹é¢çš„ä¾‹å­å¯ä»¥ç®€å•åœ°ç®¡ä¸­çª¥è±¹ã€‚

#### fork

fork ç›´æ¥å°±æ˜¯å¤šä¸ªæŸ¥è¯¢å¹¶è¡Œæ‰§è¡Œ, è¾“å‡ºç»“æœ

```Kql
StormEvents
| fork
	(where StartTime >= datetime('2007-1-1') | take 100)
	(summarize count() by State)
	( project DamageCrops, DamageProperty | take 100 )
```

![](../images/Pasted%20image%2020230101092939.png)

#### facet

facet æ˜¯æ ¹æ®å‡ ä¸ªå­—æ®µï¼ˆä¸‹ä¾‹ä¸­çš„ Stateï¼ŒEventTypeï¼ŒSourceï¼Œåšä¸€ä¸ªè®¡æ•°ï¼Œåœ¨å‰ä¸€å¥whereçš„åŸºç¡€ä¸Šï¼‰åšä¸€ä¸ªåŸºæœ¬ç»Ÿè®¡, å¹¶ç»§ç»­è¾“å‡ºä¸€ä¸ªä¸»è¦ç»“æœ ï¼ˆwithåé¢çš„è¯­å¥ï¼‰

```kql
StormEvents
| where State startswith "A" and EventType has "Heavy"
| facet by State, EventType,Source
Â  Â  with
Â  Â  (
	Â  Â  where StartTime between(datetime(2007-01-04) .. 7d)
	Â  Â  | project State, StartTime, Source, EpisodeId, EventType
	Â  Â  | take 5
Â  Â  )
```

![](../images/Pasted%20image%2020230101092902.png)

![](../images/Pasted%20image%2020230101092915.png)


Kusto çš„æŸ¥è¯¢å­¦é—®å¾ˆå¤§ï¼Œå˜åŒ–æ— ç©·ã€‚è¿™ä¸€ç« æ¶µç›–çš„éƒ¨åˆ†åªæ˜¯æœ€åŸºæœ¬çš„ä¸€äº›ï¼Œå¸Œæœ›å¤§å®¶å·²è¿™ä¸ªä¸ºèµ·ç‚¹ï¼Œç»“åˆå®é™…æ¡ˆä¾‹æ¢ç´¢æ›´å¤šæœ‰æ„æ€çš„åœºæ™¯ã€‚ä»¥åæˆ‘ä»¬å¯ä»¥å†æ·±å…¥åœ°ç ”ç©¶å’Œå­¦ä¹ ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹å…¸å‹çš„ä¸šåŠ¡åœºæ™¯çš„åˆ†ææ¡ˆä¾‹ï¼Œä»¥åŠå¦‚ä½•åˆ†æè¿™äº›æŸ¥è¯¢çš„æ€§èƒ½ï¼Œä»¥ä¾¿è¿›è¡Œä¼˜åŒ–ç­‰ç­‰ã€‚